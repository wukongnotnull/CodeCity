<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>使用Django开发商业项目 | 悟空非空也</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/img/favicon.ico">
    <script data-ad-client="ca-pub-7828333725993554" async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <meta name="description" content="集成计算机编程技术博客、知识库、学习笔记文档、技术网站导航、资源收藏、技术电子书、论坛于一体。涵盖JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github，Java,C,C++,Php,大数据，人工智能，云计算，机器深度学习和算法等技术文章和资源。">
    <meta name="keywords" content="集成计算机编程技术博客、知识库、学习笔记文档、技术网站导航、资源收藏、技术电子书、论坛于一体。涵盖JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github，Java,C,C++,Php,大数据，人工智能，云计算，机器深度学习和算法等技术文章和资源。">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    <link rel="preload" href="/assets/css/0.styles.4a9c0c84.css" as="style"><link rel="preload" href="/assets/js/app.0772105c.js" as="script"><link rel="preload" href="/assets/js/2.6497fd29.js" as="script"><link rel="preload" href="/assets/js/170.f3785783.js" as="script"><link rel="prefetch" href="/assets/js/10.0a7a5c2a.js"><link rel="prefetch" href="/assets/js/100.6dd9a587.js"><link rel="prefetch" href="/assets/js/101.b1cb7166.js"><link rel="prefetch" href="/assets/js/102.6a888436.js"><link rel="prefetch" href="/assets/js/103.075294d1.js"><link rel="prefetch" href="/assets/js/104.7f9d5a4c.js"><link rel="prefetch" href="/assets/js/105.bcc3dd3e.js"><link rel="prefetch" href="/assets/js/106.9cadb287.js"><link rel="prefetch" href="/assets/js/107.1d6b3af1.js"><link rel="prefetch" href="/assets/js/108.7377cb7f.js"><link rel="prefetch" href="/assets/js/109.ca3ceab0.js"><link rel="prefetch" href="/assets/js/11.961408a3.js"><link rel="prefetch" href="/assets/js/110.79c5c987.js"><link rel="prefetch" href="/assets/js/111.63b3d196.js"><link rel="prefetch" href="/assets/js/112.ced4f0e9.js"><link rel="prefetch" href="/assets/js/113.657daa4e.js"><link rel="prefetch" href="/assets/js/114.e5d0a86b.js"><link rel="prefetch" href="/assets/js/115.a89005f0.js"><link rel="prefetch" href="/assets/js/116.bcbccecc.js"><link rel="prefetch" href="/assets/js/117.7acf9f16.js"><link rel="prefetch" href="/assets/js/118.75e4e713.js"><link rel="prefetch" href="/assets/js/119.0395ec5d.js"><link rel="prefetch" href="/assets/js/12.aab67183.js"><link rel="prefetch" href="/assets/js/120.93179733.js"><link rel="prefetch" href="/assets/js/121.e80fc142.js"><link rel="prefetch" href="/assets/js/122.41a175f0.js"><link rel="prefetch" href="/assets/js/123.028fd9cd.js"><link rel="prefetch" href="/assets/js/124.100b1fb0.js"><link rel="prefetch" href="/assets/js/125.13d51556.js"><link rel="prefetch" href="/assets/js/126.02c987a2.js"><link rel="prefetch" href="/assets/js/127.f7e115fe.js"><link rel="prefetch" href="/assets/js/128.eb930737.js"><link rel="prefetch" href="/assets/js/129.29fef1d1.js"><link rel="prefetch" href="/assets/js/13.7dd23d29.js"><link rel="prefetch" href="/assets/js/130.7e4c3bbc.js"><link rel="prefetch" href="/assets/js/131.16f04a03.js"><link rel="prefetch" href="/assets/js/132.c811b5cf.js"><link rel="prefetch" href="/assets/js/133.4a0d2ee8.js"><link rel="prefetch" href="/assets/js/134.aa288243.js"><link rel="prefetch" href="/assets/js/135.7d74b67e.js"><link rel="prefetch" href="/assets/js/136.f6a4d7dc.js"><link rel="prefetch" href="/assets/js/137.4a8c94fa.js"><link rel="prefetch" href="/assets/js/138.30103e18.js"><link rel="prefetch" href="/assets/js/139.cb62e822.js"><link rel="prefetch" href="/assets/js/14.7a045a57.js"><link rel="prefetch" href="/assets/js/140.4849d011.js"><link rel="prefetch" href="/assets/js/141.b53f0217.js"><link rel="prefetch" href="/assets/js/142.d2e12f6f.js"><link rel="prefetch" href="/assets/js/143.41effcfd.js"><link rel="prefetch" href="/assets/js/144.5ed3025f.js"><link rel="prefetch" href="/assets/js/145.ec71ac40.js"><link rel="prefetch" href="/assets/js/146.dc482dc8.js"><link rel="prefetch" href="/assets/js/147.f43c3786.js"><link rel="prefetch" href="/assets/js/148.e60884a5.js"><link rel="prefetch" href="/assets/js/149.fd305860.js"><link rel="prefetch" href="/assets/js/15.b07b6e42.js"><link rel="prefetch" href="/assets/js/150.e294561d.js"><link rel="prefetch" href="/assets/js/151.5cda3c43.js"><link rel="prefetch" href="/assets/js/152.ec1bec3f.js"><link rel="prefetch" href="/assets/js/153.411bc769.js"><link rel="prefetch" href="/assets/js/154.d0b70cd8.js"><link rel="prefetch" href="/assets/js/155.8013985e.js"><link rel="prefetch" href="/assets/js/156.9e9c91f4.js"><link rel="prefetch" href="/assets/js/157.0273d672.js"><link rel="prefetch" href="/assets/js/158.2612db04.js"><link rel="prefetch" href="/assets/js/159.9942bd3a.js"><link rel="prefetch" href="/assets/js/16.511be8ae.js"><link rel="prefetch" href="/assets/js/160.69e027a9.js"><link rel="prefetch" href="/assets/js/161.3d0255ab.js"><link rel="prefetch" href="/assets/js/162.4f223488.js"><link rel="prefetch" href="/assets/js/163.aca282a2.js"><link rel="prefetch" href="/assets/js/164.68c99b46.js"><link rel="prefetch" href="/assets/js/165.f455fb7b.js"><link rel="prefetch" href="/assets/js/166.a4d94e8d.js"><link rel="prefetch" href="/assets/js/167.dad8c77e.js"><link rel="prefetch" href="/assets/js/168.cb0717be.js"><link rel="prefetch" href="/assets/js/169.61a9bd6a.js"><link rel="prefetch" href="/assets/js/17.bbcfeede.js"><link rel="prefetch" href="/assets/js/171.238d90d3.js"><link rel="prefetch" href="/assets/js/172.63852414.js"><link rel="prefetch" href="/assets/js/173.613fce9e.js"><link rel="prefetch" href="/assets/js/174.761ee99c.js"><link rel="prefetch" href="/assets/js/175.f2953a9b.js"><link rel="prefetch" href="/assets/js/176.415405fd.js"><link rel="prefetch" href="/assets/js/177.5c3782be.js"><link rel="prefetch" href="/assets/js/178.7c081109.js"><link rel="prefetch" href="/assets/js/179.038faa2b.js"><link rel="prefetch" href="/assets/js/18.c6108eaa.js"><link rel="prefetch" href="/assets/js/180.f498ca2e.js"><link rel="prefetch" href="/assets/js/181.ec14688f.js"><link rel="prefetch" href="/assets/js/182.1279a689.js"><link rel="prefetch" href="/assets/js/183.ced575fe.js"><link rel="prefetch" href="/assets/js/184.34f3c06c.js"><link rel="prefetch" href="/assets/js/185.b3d1acb8.js"><link rel="prefetch" href="/assets/js/186.b6efd99e.js"><link rel="prefetch" href="/assets/js/187.9b3f72f6.js"><link rel="prefetch" href="/assets/js/188.2e66f79c.js"><link rel="prefetch" href="/assets/js/189.4d12400d.js"><link rel="prefetch" href="/assets/js/19.192ec262.js"><link rel="prefetch" href="/assets/js/190.e353d2e5.js"><link rel="prefetch" href="/assets/js/191.7d655069.js"><link rel="prefetch" href="/assets/js/192.c33b286e.js"><link rel="prefetch" href="/assets/js/193.c9f461d3.js"><link rel="prefetch" href="/assets/js/194.32fdc071.js"><link rel="prefetch" href="/assets/js/195.03c708fc.js"><link rel="prefetch" href="/assets/js/196.54c890cf.js"><link rel="prefetch" href="/assets/js/197.68d0761d.js"><link rel="prefetch" href="/assets/js/198.efdf4f70.js"><link rel="prefetch" href="/assets/js/199.abaad0a6.js"><link rel="prefetch" href="/assets/js/20.d04c28bc.js"><link rel="prefetch" href="/assets/js/200.bd80bb59.js"><link rel="prefetch" href="/assets/js/201.4316ce7c.js"><link rel="prefetch" href="/assets/js/202.182fb8ad.js"><link rel="prefetch" href="/assets/js/203.7c514243.js"><link rel="prefetch" href="/assets/js/204.622bbe90.js"><link rel="prefetch" href="/assets/js/205.28f69f06.js"><link rel="prefetch" href="/assets/js/206.0c4c24eb.js"><link rel="prefetch" href="/assets/js/207.ea976c79.js"><link rel="prefetch" href="/assets/js/208.c4f49e55.js"><link rel="prefetch" href="/assets/js/209.4e2dacde.js"><link rel="prefetch" href="/assets/js/21.d8b6c127.js"><link rel="prefetch" href="/assets/js/210.c5ddee43.js"><link rel="prefetch" href="/assets/js/211.2db8e6bf.js"><link rel="prefetch" href="/assets/js/212.9e5c2afe.js"><link rel="prefetch" href="/assets/js/213.9fc56fcc.js"><link rel="prefetch" href="/assets/js/214.b22b8fd0.js"><link rel="prefetch" href="/assets/js/215.b714511d.js"><link rel="prefetch" href="/assets/js/216.4045669d.js"><link rel="prefetch" href="/assets/js/217.b8bfc481.js"><link rel="prefetch" href="/assets/js/218.4cc6231a.js"><link rel="prefetch" href="/assets/js/219.b04f0864.js"><link rel="prefetch" href="/assets/js/22.a21d9c67.js"><link rel="prefetch" href="/assets/js/220.5c5efc16.js"><link rel="prefetch" href="/assets/js/221.b3cc4226.js"><link rel="prefetch" href="/assets/js/222.14568620.js"><link rel="prefetch" href="/assets/js/223.5ad9c326.js"><link rel="prefetch" href="/assets/js/224.bef27670.js"><link rel="prefetch" href="/assets/js/225.7e76ba96.js"><link rel="prefetch" href="/assets/js/226.c892c0a5.js"><link rel="prefetch" href="/assets/js/227.1a5c5dfe.js"><link rel="prefetch" href="/assets/js/228.a83d26e3.js"><link rel="prefetch" href="/assets/js/229.f69558a4.js"><link rel="prefetch" href="/assets/js/23.e6bed599.js"><link rel="prefetch" href="/assets/js/230.975e6807.js"><link rel="prefetch" href="/assets/js/231.3323c121.js"><link rel="prefetch" href="/assets/js/232.69b5135e.js"><link rel="prefetch" href="/assets/js/233.f27782e6.js"><link rel="prefetch" href="/assets/js/234.c1e937f3.js"><link rel="prefetch" href="/assets/js/235.500694bc.js"><link rel="prefetch" href="/assets/js/236.6b6f2f84.js"><link rel="prefetch" href="/assets/js/237.a529e2ba.js"><link rel="prefetch" href="/assets/js/238.d5bca3eb.js"><link rel="prefetch" href="/assets/js/239.0b79bd7b.js"><link rel="prefetch" href="/assets/js/24.1be4b8e9.js"><link rel="prefetch" href="/assets/js/240.baec5139.js"><link rel="prefetch" href="/assets/js/241.eef96f93.js"><link rel="prefetch" href="/assets/js/242.8208455c.js"><link rel="prefetch" href="/assets/js/243.4c8fdc98.js"><link rel="prefetch" href="/assets/js/244.e11ee13c.js"><link rel="prefetch" href="/assets/js/245.b1e7beba.js"><link rel="prefetch" href="/assets/js/246.4c24ee87.js"><link rel="prefetch" href="/assets/js/247.f3958ef5.js"><link rel="prefetch" href="/assets/js/248.3f533151.js"><link rel="prefetch" href="/assets/js/249.6d80f1cd.js"><link rel="prefetch" href="/assets/js/25.7420391b.js"><link rel="prefetch" href="/assets/js/250.2faf865a.js"><link rel="prefetch" href="/assets/js/251.88d81ef7.js"><link rel="prefetch" href="/assets/js/252.04a6a69c.js"><link rel="prefetch" href="/assets/js/253.32528c6e.js"><link rel="prefetch" href="/assets/js/254.312c70ad.js"><link rel="prefetch" href="/assets/js/255.ff88a488.js"><link rel="prefetch" href="/assets/js/256.8b782088.js"><link rel="prefetch" href="/assets/js/257.1e04db72.js"><link rel="prefetch" href="/assets/js/258.6b8e65a8.js"><link rel="prefetch" href="/assets/js/259.c1a78951.js"><link rel="prefetch" href="/assets/js/26.b979a08f.js"><link rel="prefetch" href="/assets/js/260.2910b3b5.js"><link rel="prefetch" href="/assets/js/261.b3c9ff4f.js"><link rel="prefetch" href="/assets/js/262.a4846d38.js"><link rel="prefetch" href="/assets/js/263.2fe51a99.js"><link rel="prefetch" href="/assets/js/264.790ac186.js"><link rel="prefetch" href="/assets/js/265.2da80512.js"><link rel="prefetch" href="/assets/js/266.86531545.js"><link rel="prefetch" href="/assets/js/267.2d8df6ee.js"><link rel="prefetch" href="/assets/js/268.caf4f057.js"><link rel="prefetch" href="/assets/js/269.5cb1755d.js"><link rel="prefetch" href="/assets/js/27.46acb058.js"><link rel="prefetch" href="/assets/js/270.93b039ff.js"><link rel="prefetch" href="/assets/js/271.a83d9432.js"><link rel="prefetch" href="/assets/js/272.f957cb9b.js"><link rel="prefetch" href="/assets/js/273.00fda4c5.js"><link rel="prefetch" href="/assets/js/274.90d11b33.js"><link rel="prefetch" href="/assets/js/275.a5ab6a4b.js"><link rel="prefetch" href="/assets/js/276.e1553171.js"><link rel="prefetch" href="/assets/js/277.fc579c76.js"><link rel="prefetch" href="/assets/js/278.eecaef76.js"><link rel="prefetch" href="/assets/js/279.4ccbe5fd.js"><link rel="prefetch" href="/assets/js/28.d679a88b.js"><link rel="prefetch" href="/assets/js/280.1a2df8d1.js"><link rel="prefetch" href="/assets/js/281.4d879315.js"><link rel="prefetch" href="/assets/js/282.1a638b6e.js"><link rel="prefetch" href="/assets/js/283.35d77274.js"><link rel="prefetch" href="/assets/js/284.236f6c0d.js"><link rel="prefetch" href="/assets/js/285.f911dc9c.js"><link rel="prefetch" href="/assets/js/286.f2032fe0.js"><link rel="prefetch" href="/assets/js/287.47be0dd9.js"><link rel="prefetch" href="/assets/js/288.805d6e1e.js"><link rel="prefetch" href="/assets/js/289.af37d311.js"><link rel="prefetch" href="/assets/js/29.9fb32fde.js"><link rel="prefetch" href="/assets/js/290.cc34cbe3.js"><link rel="prefetch" href="/assets/js/291.887bcdbb.js"><link rel="prefetch" href="/assets/js/292.88848329.js"><link rel="prefetch" href="/assets/js/293.c5e4486a.js"><link rel="prefetch" href="/assets/js/294.4cc2aedf.js"><link rel="prefetch" href="/assets/js/295.1072aab8.js"><link rel="prefetch" href="/assets/js/296.1b0b3008.js"><link rel="prefetch" href="/assets/js/297.0f879887.js"><link rel="prefetch" href="/assets/js/298.516a7d92.js"><link rel="prefetch" href="/assets/js/299.a039e1fa.js"><link rel="prefetch" href="/assets/js/3.8f0b1c2b.js"><link rel="prefetch" href="/assets/js/30.49c708c9.js"><link rel="prefetch" href="/assets/js/300.d7f284d1.js"><link rel="prefetch" href="/assets/js/301.d0b1dd6f.js"><link rel="prefetch" href="/assets/js/302.4b55dd23.js"><link rel="prefetch" href="/assets/js/303.feb01496.js"><link rel="prefetch" href="/assets/js/304.3ab97c4d.js"><link rel="prefetch" href="/assets/js/305.591a1558.js"><link rel="prefetch" href="/assets/js/306.adb43a3c.js"><link rel="prefetch" href="/assets/js/307.b05d288b.js"><link rel="prefetch" href="/assets/js/308.4567d4af.js"><link rel="prefetch" href="/assets/js/309.72c51c16.js"><link rel="prefetch" href="/assets/js/31.11f8cedc.js"><link rel="prefetch" href="/assets/js/310.3962fc11.js"><link rel="prefetch" href="/assets/js/311.75aa7b05.js"><link rel="prefetch" href="/assets/js/312.9ec9fde7.js"><link rel="prefetch" href="/assets/js/313.d6f6baa3.js"><link rel="prefetch" href="/assets/js/314.86cdfa89.js"><link rel="prefetch" href="/assets/js/315.25959c53.js"><link rel="prefetch" href="/assets/js/316.8fa91955.js"><link rel="prefetch" href="/assets/js/317.4248ad4c.js"><link rel="prefetch" href="/assets/js/318.3f9ca0c5.js"><link rel="prefetch" href="/assets/js/319.32be3008.js"><link rel="prefetch" href="/assets/js/32.4e2e98b3.js"><link rel="prefetch" href="/assets/js/320.b8a7b72b.js"><link rel="prefetch" href="/assets/js/321.a3f7c1a6.js"><link rel="prefetch" href="/assets/js/322.d0903e0c.js"><link rel="prefetch" href="/assets/js/323.99520c43.js"><link rel="prefetch" href="/assets/js/324.333a4f10.js"><link rel="prefetch" href="/assets/js/325.e502b8f9.js"><link rel="prefetch" href="/assets/js/326.8e57faf4.js"><link rel="prefetch" href="/assets/js/327.f0473fc3.js"><link rel="prefetch" href="/assets/js/328.eaa4bf5f.js"><link rel="prefetch" href="/assets/js/329.dc0763f7.js"><link rel="prefetch" href="/assets/js/33.90114516.js"><link rel="prefetch" href="/assets/js/330.1f60cb6e.js"><link rel="prefetch" href="/assets/js/331.4af5e363.js"><link rel="prefetch" href="/assets/js/332.2a2023db.js"><link rel="prefetch" href="/assets/js/333.4c5db27a.js"><link rel="prefetch" href="/assets/js/334.f52a66e5.js"><link rel="prefetch" href="/assets/js/335.a6481538.js"><link rel="prefetch" href="/assets/js/336.6bd556c7.js"><link rel="prefetch" href="/assets/js/337.58a4d668.js"><link rel="prefetch" href="/assets/js/338.22095960.js"><link rel="prefetch" href="/assets/js/339.c8da6647.js"><link rel="prefetch" href="/assets/js/34.225b456c.js"><link rel="prefetch" href="/assets/js/340.9f93002f.js"><link rel="prefetch" href="/assets/js/341.721ab41d.js"><link rel="prefetch" href="/assets/js/342.f129aa89.js"><link rel="prefetch" href="/assets/js/343.ea2d2309.js"><link rel="prefetch" href="/assets/js/344.15235001.js"><link rel="prefetch" href="/assets/js/345.eaaae5e5.js"><link rel="prefetch" href="/assets/js/346.73b19ced.js"><link rel="prefetch" href="/assets/js/347.6e11bced.js"><link rel="prefetch" href="/assets/js/348.3b9b7968.js"><link rel="prefetch" href="/assets/js/349.b60a2b56.js"><link rel="prefetch" href="/assets/js/35.e3ec78ba.js"><link rel="prefetch" href="/assets/js/350.e793c7b9.js"><link rel="prefetch" href="/assets/js/351.c86b1ea0.js"><link rel="prefetch" href="/assets/js/352.770038d5.js"><link rel="prefetch" href="/assets/js/353.fe8f38a5.js"><link rel="prefetch" href="/assets/js/354.d3bbf169.js"><link rel="prefetch" href="/assets/js/355.5bb68a7e.js"><link rel="prefetch" href="/assets/js/356.b380aecd.js"><link rel="prefetch" href="/assets/js/357.24fbf1ff.js"><link rel="prefetch" href="/assets/js/358.669b8aba.js"><link rel="prefetch" href="/assets/js/359.04af7f75.js"><link rel="prefetch" href="/assets/js/36.dedb6e42.js"><link rel="prefetch" href="/assets/js/360.73d170d7.js"><link rel="prefetch" href="/assets/js/361.c1f55230.js"><link rel="prefetch" href="/assets/js/362.967bb47e.js"><link rel="prefetch" href="/assets/js/363.7b39c192.js"><link rel="prefetch" href="/assets/js/364.7dbf94dd.js"><link rel="prefetch" href="/assets/js/365.8a1d46d7.js"><link rel="prefetch" href="/assets/js/366.997ec05e.js"><link rel="prefetch" href="/assets/js/367.cda39f93.js"><link rel="prefetch" href="/assets/js/368.1159aebc.js"><link rel="prefetch" href="/assets/js/369.8371cbf0.js"><link rel="prefetch" href="/assets/js/37.129a1339.js"><link rel="prefetch" href="/assets/js/370.b5bda99f.js"><link rel="prefetch" href="/assets/js/371.ca4c4c31.js"><link rel="prefetch" href="/assets/js/372.6ecb7277.js"><link rel="prefetch" href="/assets/js/373.d3d1f018.js"><link rel="prefetch" href="/assets/js/374.4901bb51.js"><link rel="prefetch" href="/assets/js/375.ab11fdff.js"><link rel="prefetch" href="/assets/js/376.f34fed60.js"><link rel="prefetch" href="/assets/js/377.8d8aa0d5.js"><link rel="prefetch" href="/assets/js/378.16a432ff.js"><link rel="prefetch" href="/assets/js/379.68163d64.js"><link rel="prefetch" href="/assets/js/38.e0e2c3b1.js"><link rel="prefetch" href="/assets/js/39.a33bdbc2.js"><link rel="prefetch" href="/assets/js/4.d96ebf17.js"><link rel="prefetch" href="/assets/js/40.d20c1395.js"><link rel="prefetch" href="/assets/js/41.a2d6458f.js"><link rel="prefetch" href="/assets/js/42.48c0ea87.js"><link rel="prefetch" href="/assets/js/43.e2e765f4.js"><link rel="prefetch" href="/assets/js/44.10b67e66.js"><link rel="prefetch" href="/assets/js/45.2cd4b906.js"><link rel="prefetch" href="/assets/js/46.7a02c8ab.js"><link rel="prefetch" href="/assets/js/47.d88632c9.js"><link rel="prefetch" href="/assets/js/48.ade443fe.js"><link rel="prefetch" href="/assets/js/49.4d2ddb3b.js"><link rel="prefetch" href="/assets/js/5.037e08ba.js"><link rel="prefetch" href="/assets/js/50.463230b1.js"><link rel="prefetch" href="/assets/js/51.83c9a564.js"><link rel="prefetch" href="/assets/js/52.56c5a325.js"><link rel="prefetch" href="/assets/js/53.72a3b829.js"><link rel="prefetch" href="/assets/js/54.8f59548e.js"><link rel="prefetch" href="/assets/js/55.0faca6a3.js"><link rel="prefetch" href="/assets/js/56.77474658.js"><link rel="prefetch" href="/assets/js/57.4e4789fa.js"><link rel="prefetch" href="/assets/js/58.9dc82ebc.js"><link rel="prefetch" href="/assets/js/59.2147b861.js"><link rel="prefetch" href="/assets/js/6.8af55c48.js"><link rel="prefetch" href="/assets/js/60.d0ff683a.js"><link rel="prefetch" href="/assets/js/61.331527c3.js"><link rel="prefetch" href="/assets/js/62.a9085bf0.js"><link rel="prefetch" href="/assets/js/63.ecaf766f.js"><link rel="prefetch" href="/assets/js/64.f9a1f00a.js"><link rel="prefetch" href="/assets/js/65.69eef128.js"><link rel="prefetch" href="/assets/js/66.7ce420d5.js"><link rel="prefetch" href="/assets/js/67.059927af.js"><link rel="prefetch" href="/assets/js/68.d1e1fb62.js"><link rel="prefetch" href="/assets/js/69.a98be775.js"><link rel="prefetch" href="/assets/js/7.330a4708.js"><link rel="prefetch" href="/assets/js/70.c773f1fb.js"><link rel="prefetch" href="/assets/js/71.23db970d.js"><link rel="prefetch" href="/assets/js/72.3f45b262.js"><link rel="prefetch" href="/assets/js/73.cc16dadf.js"><link rel="prefetch" href="/assets/js/74.1f05b2b1.js"><link rel="prefetch" href="/assets/js/75.3cd7d993.js"><link rel="prefetch" href="/assets/js/76.1e78e542.js"><link rel="prefetch" href="/assets/js/77.d97d60f9.js"><link rel="prefetch" href="/assets/js/78.6997cb3a.js"><link rel="prefetch" href="/assets/js/79.e8ef607f.js"><link rel="prefetch" href="/assets/js/8.cca0e264.js"><link rel="prefetch" href="/assets/js/80.57d72889.js"><link rel="prefetch" href="/assets/js/81.7aee8496.js"><link rel="prefetch" href="/assets/js/82.0b920de1.js"><link rel="prefetch" href="/assets/js/83.429d7e6f.js"><link rel="prefetch" href="/assets/js/84.c74f1357.js"><link rel="prefetch" href="/assets/js/85.71d21661.js"><link rel="prefetch" href="/assets/js/86.d55ba6f0.js"><link rel="prefetch" href="/assets/js/87.6566a5fc.js"><link rel="prefetch" href="/assets/js/88.6cfa26b6.js"><link rel="prefetch" href="/assets/js/89.0a9ed463.js"><link rel="prefetch" href="/assets/js/9.ef46dc1c.js"><link rel="prefetch" href="/assets/js/90.507b8bb7.js"><link rel="prefetch" href="/assets/js/91.0c374e4a.js"><link rel="prefetch" href="/assets/js/92.1f6e9c9d.js"><link rel="prefetch" href="/assets/js/93.33a64374.js"><link rel="prefetch" href="/assets/js/94.68d20253.js"><link rel="prefetch" href="/assets/js/95.2cf46b84.js"><link rel="prefetch" href="/assets/js/96.9b292e88.js"><link rel="prefetch" href="/assets/js/97.1575dbac.js"><link rel="prefetch" href="/assets/js/98.b8682f4a.js"><link rel="prefetch" href="/assets/js/99.0039b460.js">
    <link rel="stylesheet" href="/assets/css/0.styles.4a9c0c84.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/favicon.ico" alt="悟空非空也" class="logo"> <span class="site-name can-hide">悟空非空也</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博客" class="dropdown-title"><a href="/blogs/" class="link-title">博客</a> <span class="title" style="display:none;">博客</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/WuKongNotNull/awesome-free-vpn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  科学上网
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/categories/?category=%E5%A5%BD%E7%89%A9%E6%8E%A8%E8%8D%90%E5%AE%98&amp;.html" class="nav-link">好物推荐官</a></li><li class="dropdown-item"><!----> <a href="/categories/?category=%E9%9A%8F%E7%AC%94&amp;.html" class="nav-link">随笔感悟</a></li></ul></div></div><div class="nav-item"><a href="/pages/3ad3de/" class="nav-link">编程导航</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/java/" class="link-title">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java/javase/" class="nav-link">JavaSE</a></li><li class="dropdown-item"><!----> <a href="/java/javaee/" class="nav-link">JavaEE</a></li><li class="dropdown-item"><!----> <a href="/java/spring/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/java/mybatis/" class="nav-link">MyBatis</a></li><li class="dropdown-item"><!----> <a href="/java/springboot/" class="nav-link">SpringBoot</a></li><li class="dropdown-item"><!----> <a href="/java/springcloud/" class="nav-link">SpringCloud</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Python" class="dropdown-title"><a href="/python/" class="link-title">Python</a> <span class="title" style="display:none;">Python</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/python/tutorial/" class="nav-link">Python教程</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大前端" class="dropdown-title"><a href="/fore/" class="link-title">大前端</a> <span class="title" style="display:none;">大前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fore/javascript/" class="nav-link">JavaScript基础教程</a></li><li class="dropdown-item"><!----> <a href="/fore/js/" class="nav-link">JavaScript高级程序设计</a></li><li class="dropdown-item"><!----> <a href="/fore/es6/" class="nav-link">ES6 教程</a></li><li class="dropdown-item"><!----> <a href="/fore/vue/" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/fore/react/" class="nav-link">React</a></li><li class="dropdown-item"><!----> <a href="/fore/typescript-axios/" class="nav-link">TypeScript 从零实现 axios</a></li><li class="dropdown-item"><!----> <a href="/fore/git/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/pages/51afd6/" class="nav-link">TypeScript</a></li><li class="dropdown-item"><!----> <a href="/pages/4643cd/" class="nav-link">JS设计模式总结</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试" class="dropdown-title"><a href="/interview/" class="link-title">面试</a> <span class="title" style="display:none;">面试</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/interview/c/" class="nav-link">C开发岗</a></li><li class="dropdown-item"><!----> <a href="/interview/java/" class="nav-link">Java开发岗</a></li><li class="dropdown-item"><!----> <a href="/interview/python/" class="nav-link">Python开发岗</a></li><li class="dropdown-item"><!----> <a href="/interview/hr/" class="nav-link">人事爱问</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f4931c/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/norm/alisongshan/" class="nav-link">阿里Java开发手册</a></li><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于我</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.jsdelivr.net/gh/wuKongNotNull/images-hosting/wukong-website/wukong-favicon-nobg.png"> <div class="blogger-info"><h3>悟空非空也</h3> <span>精通各语言拼写的野生程序员</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博客" class="dropdown-title"><a href="/blogs/" class="link-title">博客</a> <span class="title" style="display:none;">博客</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/WuKongNotNull/awesome-free-vpn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  科学上网
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/categories/?category=%E5%A5%BD%E7%89%A9%E6%8E%A8%E8%8D%90%E5%AE%98&amp;.html" class="nav-link">好物推荐官</a></li><li class="dropdown-item"><!----> <a href="/categories/?category=%E9%9A%8F%E7%AC%94&amp;.html" class="nav-link">随笔感悟</a></li></ul></div></div><div class="nav-item"><a href="/pages/3ad3de/" class="nav-link">编程导航</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/java/" class="link-title">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java/javase/" class="nav-link">JavaSE</a></li><li class="dropdown-item"><!----> <a href="/java/javaee/" class="nav-link">JavaEE</a></li><li class="dropdown-item"><!----> <a href="/java/spring/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/java/mybatis/" class="nav-link">MyBatis</a></li><li class="dropdown-item"><!----> <a href="/java/springboot/" class="nav-link">SpringBoot</a></li><li class="dropdown-item"><!----> <a href="/java/springcloud/" class="nav-link">SpringCloud</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Python" class="dropdown-title"><a href="/python/" class="link-title">Python</a> <span class="title" style="display:none;">Python</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/python/tutorial/" class="nav-link">Python教程</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大前端" class="dropdown-title"><a href="/fore/" class="link-title">大前端</a> <span class="title" style="display:none;">大前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fore/javascript/" class="nav-link">JavaScript基础教程</a></li><li class="dropdown-item"><!----> <a href="/fore/js/" class="nav-link">JavaScript高级程序设计</a></li><li class="dropdown-item"><!----> <a href="/fore/es6/" class="nav-link">ES6 教程</a></li><li class="dropdown-item"><!----> <a href="/fore/vue/" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/fore/react/" class="nav-link">React</a></li><li class="dropdown-item"><!----> <a href="/fore/typescript-axios/" class="nav-link">TypeScript 从零实现 axios</a></li><li class="dropdown-item"><!----> <a href="/fore/git/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/pages/51afd6/" class="nav-link">TypeScript</a></li><li class="dropdown-item"><!----> <a href="/pages/4643cd/" class="nav-link">JS设计模式总结</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试" class="dropdown-title"><a href="/interview/" class="link-title">面试</a> <span class="title" style="display:none;">面试</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/interview/c/" class="nav-link">C开发岗</a></li><li class="dropdown-item"><!----> <a href="/interview/java/" class="nav-link">Java开发岗</a></li><li class="dropdown-item"><!----> <a href="/interview/python/" class="nav-link">Python开发岗</a></li><li class="dropdown-item"><!----> <a href="/interview/hr/" class="nav-link">人事爱问</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f4931c/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/norm/alisongshan/" class="nav-link">阿里Java开发手册</a></li><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于我</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python教程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Django</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/abe3f1/" class="sidebar-link">Django快速上手</a></li><li><a href="/pages/e05855/" class="sidebar-link">深入模型</a></li><li><a href="/pages/5e073d/" class="sidebar-link">静态资源和Ajax请求</a></li><li><a href="/pages/fe1c13/" class="sidebar-link">Cookie和Session</a></li><li><a href="/pages/752e82/" class="sidebar-link">制作报表</a></li><li><a href="/pages/69c36a/" class="sidebar-link">日志和调试工具栏</a></li><li><a href="/pages/d8a6c2/" class="sidebar-link">中间件的应用</a></li><li><a href="/pages/6901e0/" class="sidebar-link">前后端分离开发入门</a></li><li><a href="/pages/94cc32/" class="sidebar-link">RESTful架构和DRF入门</a></li><li><a href="/pages/21e253/" class="sidebar-link">RESTful架构和DRF进阶</a></li><li><a href="/pages/da7d00/" class="sidebar-link">使用缓存</a></li><li><a href="/pages/f977ab/" class="sidebar-link">接入三方平台</a></li><li><a href="/pages/dc0c08/" class="sidebar-link">异步任务和定时任务</a></li><li><a href="/pages/f68704/" class="sidebar-link">用FastAPI开发数据接口</a></li><li><a href="/pages/5dc046/" aria-current="page" class="active sidebar-link">使用Django开发商业项目</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/5dc046/#web应用" class="sidebar-link">Web应用</a></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#mvc架构模式" class="sidebar-link">MVC架构模式</a></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#http请求和响应" class="sidebar-link">HTTP请求和响应</a></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#数据模型-model" class="sidebar-link">数据模型(Model)</a></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#视图函数-controller" class="sidebar-link">视图函数(Controller)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/5dc046/#如何设计视图函数" class="sidebar-link">如何设计视图函数</a></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#url配置" class="sidebar-link">URL配置</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#模板-view" class="sidebar-link">模板(View)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/5dc046/#后端渲染" class="sidebar-link">后端渲染</a></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#前端渲染" class="sidebar-link">前端渲染</a></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#其他视图" class="sidebar-link">其他视图</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#中间件" class="sidebar-link">中间件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/5dc046/#激活中间件" class="sidebar-link">激活中间件</a></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#自定义中间件" class="sidebar-link">自定义中间件</a></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#内置中间件" class="sidebar-link">内置中间件</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#表单" class="sidebar-link">表单</a></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#cookie和session" class="sidebar-link">Cookie和Session</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/5dc046/#session的配置" class="sidebar-link">Session的配置</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#缓存" class="sidebar-link">缓存</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/5dc046/#配置缓存" class="sidebar-link">配置缓存</a></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#全站缓存" class="sidebar-link">全站缓存</a></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#视图层缓存" class="sidebar-link">视图层缓存</a></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#其他内容" class="sidebar-link">其他内容</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#日志" class="sidebar-link">日志</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/5dc046/#日志级别" class="sidebar-link">日志级别</a></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#日志配置" class="sidebar-link">日志配置</a></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#日志分析" class="sidebar-link">日志分析</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#restful" class="sidebar-link">RESTful</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/5dc046/#编写序列化器" class="sidebar-link">编写序列化器</a></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#方法1-使用装饰器" class="sidebar-link">方法1：使用装饰器</a></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#方法2-使用apiview及其子类" class="sidebar-link">方法2：使用APIView及其子类</a></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#方法3-使用viewset及其子类" class="sidebar-link">方法3：使用ViewSet及其子类</a></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#过滤数据" class="sidebar-link">过滤数据</a></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#身份认证" class="sidebar-link">身份认证</a></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#授予权限" class="sidebar-link">授予权限</a></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#访问限流" class="sidebar-link">访问限流</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#异步任务和计划任务" class="sidebar-link">异步任务和计划任务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/5dc046/#celery的应用" class="sidebar-link">Celery的应用</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#其他问题" class="sidebar-link">其他问题</a></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#安全保护" class="sidebar-link">安全保护</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/5dc046/#django提供的安全措施" class="sidebar-link">Django提供的安全措施</a></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#用户敏感信息的保护" class="sidebar-link">用户敏感信息的保护</a></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#安全相关建议" class="sidebar-link">安全相关建议</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#测试相关" class="sidebar-link">测试相关</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/5dc046/#功能测试" class="sidebar-link">功能测试</a></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#性能测试" class="sidebar-link">性能测试</a></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#安全性测试" class="sidebar-link">安全性测试</a></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#其他测试" class="sidebar-link">其他测试</a></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#单元测试" class="sidebar-link">单元测试</a></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#集成测试" class="sidebar-link">集成测试</a></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#系统测试" class="sidebar-link">系统测试</a></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#数据驱动测试" class="sidebar-link">数据驱动测试</a></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#django中的测试" class="sidebar-link">Django中的测试</a></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#性能测试-2" class="sidebar-link">性能测试</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#项目调试" class="sidebar-link">项目调试</a></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#部署相关" class="sidebar-link">部署相关</a></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#性能相关" class="sidebar-link">性能相关</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/5dc046/#网站优化两大定律" class="sidebar-link">网站优化两大定律：</a></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#django框架" class="sidebar-link">Django框架</a></li><li class="sidebar-sub-header"><a href="/pages/5dc046/#数据库" class="sidebar-link">数据库</a></li></ul></li></ul></li><li><a href="/pages/5d0abd/" class="sidebar-link">电商网站技术要点剖析</a></li><li><a href="/pages/b03f9b/" class="sidebar-link">项目部署上线和性能调优</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>网络爬虫</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据分析</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>人工智能</span> <span class="arrow right"></span></p> <!----></section></li></ul> <div class="sidebar-slot sidebar-slot-bottom"><!-- 正方形 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="3508773082"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div></aside> <div><main class="page"><div class="theme-vdoing-wrapper bg-style-1"><div class="articleInfo-wrap" data-v-1cd794fe><div class="articleInfo" data-v-1cd794fe><ul class="breadcrumbs" data-v-1cd794fe><li data-v-1cd794fe><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-1cd794fe></a></li> <li data-v-1cd794fe><a href="/python" title="Python-目录页" data-v-1cd794fe>Python</a></li> <li data-v-1cd794fe><a href="/python/#Django" title="Python#Django" data-v-1cd794fe>Django</a></li> <!----></ul> <div class="info" data-v-1cd794fe><div title="作者" class="author iconfont icon-touxiang" data-v-1cd794fe><a href="https://github.com/wuKongNotNull" target="_blank" title="作者" class="beLink" data-v-1cd794fe>悟空非空也</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-1cd794fe><a href="javascript:;" data-v-1cd794fe>2021-10-31</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">
          使用Django开发商业项目
        </h1> <div class="page-slot page-slot-top"><!-- 固定100% * 90px可显示，max-height:90px未见显示-->
     <ins class="adsbygoogle"
          style="display:inline-block;width:100%;max-height:90px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6625304284"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="theme-vdoing-content content__default"><h1 id="使用django开发商业项目"><a href="#使用django开发商业项目" class="header-anchor">#</a> 使用Django开发商业项目</h1> <blockquote><p><strong>说明</strong>：本文的部分插图来自于《Python项目开发实战》和《精通Django》，这两本书中都包含了对Django框架精彩的讲解，有兴趣的读者可以自行购买阅读。</p></blockquote> <h2 id="web应用"><a href="#web应用" class="header-anchor">#</a> Web应用</h2> <p>问题1：描述一个Web应用的工作流程。</p> <p><img src="https://cdn.jsdelivr.net/gh/wuKongNotNull/images-hosting/wukong-website/web-application1.png" alt=""></p> <p>问题2：描述项目的物理架构。（上图中补充负载均衡（反向代理）服务器、数据库服务器、文件服务器、邮件服务器、缓存服务器、防火墙等，而且每个节点都有可能是多节点构成的集群。当然，架构都是根据业务的需要一步步演进而不是一蹴而就的。）</p> <p>问题3：描述Django项目的工作流程。（如下图所示）</p> <p><img src="https://cdn.jsdelivr.net/gh/wuKongNotNull/images-hosting/wukong-website/django_request_response_cycle.png" alt=""></p> <h2 id="mvc架构模式"><a href="#mvc架构模式" class="header-anchor">#</a> MVC架构模式</h2> <p>问题1：为什么要使用MVC架构模式？（模型和视图解耦合）</p> <p>问题2：MVC架构中每个部分的作用？（如下图所示）</p> <p><img src="https://cdn.jsdelivr.net/gh/wuKongNotNull/images-hosting/wukong-website/mvc1.png" alt=""></p> <h2 id="http请求和响应"><a href="#http请求和响应" class="header-anchor">#</a> HTTP请求和响应</h2> <h4 id="http请求-请求行-请求头-空行-消息体"><a href="#http请求-请求行-请求头-空行-消息体" class="header-anchor">#</a> HTTP请求 = 请求行+请求头+空行+[消息体]</h4> <p><img src="https://cdn.jsdelivr.net/gh/wuKongNotNull/images-hosting/wukong-website/http-request1031.png" alt=""></p> <h4 id="http响应-响应行-响应头-空行-消息体"><a href="#http响应-响应行-响应头-空行-消息体" class="header-anchor">#</a> HTTP响应 = 响应行+响应头+空行+消息体</h4> <p><img src="https://cdn.jsdelivr.net/gh/wuKongNotNull/images-hosting/wukong-website/http-response1111.png" alt=""></p> <ol><li><p><code>HTTPRequest</code>对象的属性和方法：</p> <ul><li><code>method</code> - 获取请求方法</li> <li><code>path</code> / <code>get_full_path()</code> - 获取请求路径/带查询字符串的路径</li> <li><code>scheme</code> / <code>is_secure()</code> / <code>get_host()</code> / <code>get_port()</code> - 获取请求的协议/主机/端口</li> <li><code>META</code> / <code>COOKIES</code> - 获取请求头/Cookie信息</li> <li><code>GET</code> / <code>POST</code> / <code>FILES</code> - 获取GET或POST请求参数/上传的文件</li> <li><code>get_signed_cookie()</code> - 获取带签名的Cookie</li> <li><code>is_ajax()</code> - 是不是Ajax异步请求</li> <li><code>body</code> / <code>content_type</code> / <code>encoding</code> - 获取请求的消息体（bytes流）/MIME类型/编码</li></ul></li> <li><p>中间件添加的属性：</p> <ul><li><code>session</code> / <code>user</code> / <code>site</code></li></ul></li> <li><p><code>HttpResponse</code>对象的属性和方法：</p> <ul><li><code>set_cookie()</code> / <code>set_signed_cookie()</code> / <code>delete_cookie()</code> - 添加/删除Cookie</li> <li><code>__setitem__</code> / <code>__getitem__</code> / <code>__delitem__</code> - 添加/获取/删除响应头</li> <li><code>charset</code> / <code>content</code> / <code>status_code</code> - 响应的字符集/消息体（bytes流）/状态码
<ul><li>1xx：请求已经收到，继续处理</li> <li>2xx（成功）：请求已经成功收到、理解和接收。</li> <li>3xx（重定向）：为完成请求要继续执行后续的操作。</li> <li>4xx（客户端错误）：请求不正确或不能够被受理。</li> <li>5xx（服务器错误）：服务器处理请求失败。</li></ul></li></ul></li> <li><p><code>JsonResponse</code>（<code>HttpResponse</code>的子类型）对象</p> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> django<span class="token punctuation">.</span>http <span class="token keyword">import</span> HttpResponse<span class="token punctuation">,</span> JsonResponse
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> response <span class="token operator">=</span> JsonResponse<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'foo'</span><span class="token punctuation">:</span> <span class="token string">'bar'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> response<span class="token punctuation">.</span>content
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> response <span class="token operator">=</span> JsonResponse<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> safe<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> response<span class="token punctuation">.</span>content
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> response <span class="token operator">=</span> HttpResponse<span class="token punctuation">(</span><span class="token string">b'...'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> response<span class="token punctuation">[</span><span class="token string">'cotent-type'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'application/pdf'</span><span class="token punctuation">;</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> response<span class="token punctuation">[</span><span class="token string">'content-disposition'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'inline; filename=&quot;xyz.pdf&quot;'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> response<span class="token punctuation">[</span><span class="token string">'content-disposition'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'attachment; filename=&quot;xyz.pdf&quot;'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> response<span class="token punctuation">.</span>set_signed_cookie<span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">,</span> salt<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> response<span class="token punctuation">.</span>status_code <span class="token operator">=</span> <span class="token number">200</span>
</code></pre></div></li></ol> <h2 id="数据模型-model"><a href="#数据模型-model" class="header-anchor">#</a> 数据模型(Model)</h2> <p>问题1：关系型数据库表的设计应该注意哪些问题（范式理论和逆范式）？如何通过表来创建模型类（反向工程）？如何通过模型类来创建表（正向工程）？</p> <div class="language-Shell extra-class"><pre class="language-shell"><code>python manage.py makemigrations <span class="token operator">&lt;</span>appname<span class="token operator">&gt;</span>
python manage.py migrate

python manage.py inspectdb <span class="token operator">&gt;</span> <span class="token operator">&lt;</span>appname<span class="token operator">&gt;</span>/models.py
</code></pre></div><p>问题2：关系型数据库中数据完整性指的是什么？什么时候需要牺牲数据完整性？（实体完整性/参照完整性/域完整性）</p> <p>问题3：ORM是什么以及解决了什么问题？（对象模型-关系模型双向转换）</p> <ol><li><p><code>Field</code>及其子类的属性：</p> <ul><li>通用选项：
<ul><li><code>db_column</code> / <code>db_tablespace</code></li> <li><code>null</code> / <code>blank</code> / <code>default</code></li> <li><code>primary_key</code></li> <li><code>db_index</code> / <code>unqiue</code></li> <li><code>choices</code> / <code>help_text</code> / <code>error_message</code> / <code>editable</code> / <code>hidden</code></li></ul></li> <li>其他选项：
<ul><li><code>CharField</code>: <code>max_length</code></li> <li><code>DateField</code>: <code>auto_now</code> / <code>auto_now_add</code></li> <li><code>DecimalField</code>: <code>max_digits</code> / <code>decimal_places</code></li> <li><code>FileField</code>: <code>storage</code> / <code>upload_to</code></li> <li><code>ImageField</code>: <code>height_field</code> / <code>width_field</code></li></ul></li></ul></li> <li><p><code>ForeignKey</code>的属性：</p> <ul><li><p>重要属性：</p> <ul><li><p><code>db_constraint</code>（提升性能或者数据分片的情况可能需要设置为<code>False</code>）</p></li> <li><p><code>on_delete</code></p> <ul><li><code>CASCADE</code>：级联删除。</li></ul> <ul><li><code>PROTECT</code>：抛出<code>ProtectedError</code>异常，阻止删除引用的对象。</li> <li><code>SET_NULL</code>：把外键设置为<code>null</code>，当<code>null</code>属性被设置为<code>True</code>时才能这么做。</li> <li><code>SET_DEFAULT</code>：把外键设置为默认值，提供了默认值才能这么做。</li></ul></li> <li><p><code>related_name</code></p> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Dept</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>


<span class="token keyword">class</span> <span class="token class-name">Emp</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    dept <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>related_name<span class="token operator">=</span><span class="token string">'+'</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
    
 
Dept<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>no<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span>emp_set<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
Emp<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>dept__no<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>说明：<code>related_name</code>设置为<code>'+'</code>，可以防止一对多外键关联从“一”的一方查询“多”的一方。</p></blockquote></li></ul></li> <li><p>其他属性：</p> <ul><li><code>to_field</code> / <code>limit_choices_to</code> / <code>swappable</code></li></ul></li></ul></li> <li><p><code>Model</code>的属性和方法</p> <ul><li><p><code>objects</code> / <code>pk</code></p></li> <li><p><code>save()</code> / <code>delete()</code></p></li> <li><p><code>clean()</code> / <code>validate_unique()</code> / <code>full_clean()</code></p></li></ul></li> <li><p><code>QuerySet</code>的方法</p> <ul><li><p><code>get()</code> / <code>all()</code> / <code>values()</code></p> <blockquote><p>说明：<code>values()</code>返回的<code>QuerySet</code>中不是模型对象而是字典</p></blockquote></li> <li><p><code>count()</code> / <code>order_by()</code> / <code>exists()</code> / <code>reverse()</code></p></li> <li><p><code>filter()</code> / <code>exclude()</code></p> <ul><li><p><code>exact</code> / <code>iexact</code>：精确匹配/忽略大小写的精确匹配查询</p></li> <li><p><code>contains</code> / <code>icontains</code> / <code>startswith / istartswith / endswith / iendswith</code>：基于<code>like</code>的模糊查询</p></li> <li><p><code>in</code>：集合运算</p></li> <li><p><code>gt</code> / <code>gte</code> / <code>lt</code> / <code>lte</code>：大于/大于等于/小于/小于等于关系运算</p></li> <li><p><code>range</code>：指定范围查询（SQL中的<code>between…and…</code>）</p></li> <li><p><code>year</code> / <code>month</code> / <code>day</code> / <code>week_day</code> / <code>hour</code> / <code>minute</code> / <code>second</code>：查询时间日期</p></li> <li><p><code>isnull</code>：查询空值（<code>True</code>）或非空值（<code>False</code>）</p></li> <li><p><code>search</code>：基于全文索引的全文检索</p></li> <li><p><code>regex</code> / <code>iregex</code>：基于正则表达式的模糊匹配查询</p></li> <li><p><code>aggregate()</code> / <code>annotate()</code></p></li> <li><p><code>Avg</code> / <code>Count</code> / <code>Sum</code> / <code>Max</code> / <code>Min</code></p> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> Avg
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Emp<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>aggregate<span class="token punctuation">(</span>avg_sal<span class="token operator">=</span>Avg<span class="token punctuation">(</span><span class="token string">'sal'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">0.001</span><span class="token punctuation">)</span> SELECT AVG<span class="token punctuation">(</span>`TbEmp`<span class="token punctuation">.</span>`sal`<span class="token punctuation">)</span> AS `avg_sal` FROM `TbEmp`<span class="token punctuation">;</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span><span class="token string">'avg_sal'</span><span class="token punctuation">:</span> <span class="token number">3521.4286</span><span class="token punctuation">}</span>
</code></pre></div><div class="language-Python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Emp<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">'dept'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>annotate<span class="token punctuation">(</span>total<span class="token operator">=</span>Count<span class="token punctuation">(</span><span class="token string">'dept'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">0.001</span><span class="token punctuation">)</span> SELECT `TbEmp`<span class="token punctuation">.</span>`dno`<span class="token punctuation">,</span> COUNT<span class="token punctuation">(</span>`TbEmp`<span class="token punctuation">.</span>`dno`<span class="token punctuation">)</span> AS `total` FROM `TbEmp` GROUP BY `TbEmp`<span class="token punctuation">.</span>`dno` ORDER BY NULL LIMIT <span class="token number">21</span><span class="token punctuation">;</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span>QuerySet <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">'dept'</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">'total'</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'dept'</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">'total'</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'dept'</span><span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token string">'total'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre></div></li></ul></li> <li><p><code>first()</code> / <code>last()</code></p> <blockquote><p>说明：调用<code>first()</code>方法相当于用<code>[0]</code>对<code>QuerySet</code>进行切片。</p></blockquote></li> <li><p><code>only()</code> / <code>defer()</code></p> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Emp<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">7800</span><span class="token punctuation">)</span><span class="token punctuation">.</span>only<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'sal'</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">0.001</span><span class="token punctuation">)</span> SELECT `TbEmp`<span class="token punctuation">.</span>`empno`<span class="token punctuation">,</span> `TbEmp`<span class="token punctuation">.</span>`ename`<span class="token punctuation">,</span> `TbEmp`<span class="token punctuation">.</span>`sal` FROM `TbEmp` WHERE `TbEmp`<span class="token punctuation">.</span>`empno` <span class="token operator">=</span> <span class="token number">7800</span> LIMIT <span class="token number">21</span><span class="token punctuation">;</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">7800</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span>QuerySet <span class="token punctuation">[</span><span class="token operator">&lt;</span>Emp<span class="token punctuation">:</span> Emp <span class="token builtin">object</span> <span class="token punctuation">(</span><span class="token number">7800</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Emp<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">7800</span><span class="token punctuation">)</span><span class="token punctuation">.</span>defer<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'sal'</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">0.001</span><span class="token punctuation">)</span> SELECT `TbEmp`<span class="token punctuation">.</span>`empno`<span class="token punctuation">,</span> `TbEmp`<span class="token punctuation">.</span>`job`<span class="token punctuation">,</span> `TbEmp`<span class="token punctuation">.</span>`mgr`<span class="token punctuation">,</span> `TbEmp`<span class="token punctuation">.</span>`comm`<span class="token punctuation">,</span> `TbEmp`<span class="token punctuation">.</span>`dno` FROM `TbEmp` WHERE `TbEmp`<span class="token punctuation">.</span>`empno` <span class="token operator">=</span> <span class="token number">7800</span> LIMIT <span class="token number">21</span><span class="token punctuation">;</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">7800</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span>QuerySet <span class="token punctuation">[</span><span class="token operator">&lt;</span>Emp<span class="token punctuation">:</span> Emp <span class="token builtin">object</span> <span class="token punctuation">(</span><span class="token number">7800</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>
</code></pre></div></li> <li><p><code>create()</code> / <code>update()</code> / <code>raw()</code></p> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Emp<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>dept__no<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span>sal<span class="token operator">=</span>F<span class="token punctuation">(</span><span class="token string">'sal'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">100</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">0.011</span><span class="token punctuation">)</span> UPDATE `TbEmp` SET `sal` <span class="token operator">=</span> <span class="token punctuation">(</span>`TbEmp`<span class="token punctuation">.</span>`sal` <span class="token operator">+</span> <span class="token number">100</span><span class="token punctuation">)</span> WHERE `TbEmp`<span class="token punctuation">.</span>`dno` <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Emp<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>raw<span class="token punctuation">(</span><span class="token string">'select empno, ename, job from TbEmp where dno=10'</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span>RawQuerySet<span class="token punctuation">:</span> select empno<span class="token punctuation">,</span> ename<span class="token punctuation">,</span> job <span class="token keyword">from</span> TbEmp where dno<span class="token operator">=</span><span class="token number">10</span><span class="token operator">&gt;</span>
</code></pre></div></li></ul></li> <li><p><code>Q</code>对象和<code>F</code>对象</p> <blockquote><p>说明：Q对象主要用来解决多条件组合的复杂查询；F对象主要用于更新数据。</p></blockquote> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> Q
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Emp<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     Q<span class="token punctuation">(</span>name__startswith<span class="token operator">=</span><span class="token string">'张'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     Q<span class="token punctuation">(</span>sal__lte<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">)</span> <span class="token operator">|</span> Q<span class="token punctuation">(</span>comm__gte<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span> <span class="token comment"># 查询名字以“张”开头且工资小于等于5000或补贴大于等于1000的员工</span>
<span class="token operator">&lt;</span>QuerySet <span class="token punctuation">[</span><span class="token operator">&lt;</span>Emp<span class="token punctuation">:</span> 张三丰<span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>
</code></pre></div><div class="language-Python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> backend<span class="token punctuation">.</span>models <span class="token keyword">import</span> Emp<span class="token punctuation">,</span> Dept
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> emps <span class="token operator">=</span> Emp<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>dept__no<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> F
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> emps<span class="token punctuation">.</span>update<span class="token punctuation">(</span>sal<span class="token operator">=</span>F<span class="token punctuation">(</span><span class="token string">'sal'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">100</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>原生SQL查询</p> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> connections


<span class="token keyword">with</span> connections<span class="token punctuation">[</span><span class="token string">'...'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> cursor<span class="token punctuation">:</span>
    cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">&quot;UPDATE TbEmp SET sal=sal+10 WHERE dno=30&quot;</span><span class="token punctuation">)</span>
    cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">&quot;SELECT ename, job FROM TbEmp WHERE dno=10&quot;</span><span class="token punctuation">)</span>
    row <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>模型管理器</p> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">BookManager</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Manager<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token keyword">def</span> <span class="token function">title_count</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> keyword<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>title__icontains<span class="token operator">=</span>keyword<span class="token punctuation">)</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Book</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    objects <span class="token operator">=</span> BookManager<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></li></ol> <h2 id="视图函数-controller"><a href="#视图函数-controller" class="header-anchor">#</a> 视图函数(Controller)</h2> <h3 id="如何设计视图函数"><a href="#如何设计视图函数" class="header-anchor">#</a> 如何设计视图函数</h3> <ol><li><p>用户的每个请求（用户故事）对应一个视图函数，当然也可以将用户要执行的业务逻辑封装到独立的函数中，也就是有专门的模块处理程序中的业务逻辑。</p></li> <li><p>用户的请求可能会包含多个（持久化）操作，这些操作有可能需要设计成不可分割的原子性操作，那么这里就形成了事务的边界。</p> <ul><li><p>事务的ACID特性。</p> <ul><li>原子性（Atomicity）：事务中各项的操作要么全做要么全不做；</li> <li>一致性（Consistentcy）：事务前后系统的状态是一致的；</li> <li>隔离性（Isolation）：并发执行的事务无法看到彼此的中间状态；</li> <li>持久性（Duration）：事务完成后所做的改动都会被持久化。</li></ul></li> <li><p>事务隔离级别 - 设置事务隔离级别是为了数据库底层依据事务隔离级别为数据加上适当的锁。如果需要保证数据的强一致性，那么关系型数据库仍然是唯一的也是最好的选择，因为关系型数据库可以通过锁机制来保护数据。事务隔离级别从低到高依次是：Read Uncommitted（读未提交）、Read Committed（读提交）、Repeatable Read（可重复读）、Serializable（串行化）。事务隔离级别越高，数据并发访问的问题越少，但是性能越差；事务隔离级别越低，数据并发访问的问题越多，但是性能越好。</p></li> <li><p>数据并发访问会产生5种问题（请参考我的<a href="https://blog.csdn.net/jackfrued/article/details/44921941" target="_blank" rel="noopener noreferrer">《Java面试题全集（上）》<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>第80题对该问题的讲解）：</p> <ul><li>第1类丢失更新（A事务撤销覆盖B事务更新的数据）和第2类丢失更新（A事务提交覆盖B事务更新的数据）。</li> <li>脏读（读脏数据）：一个事务读取到其他尚未提交的事务的数据。</li> <li>不可重复读： 一个事务在读取它的查询结果时，被另一个事务更新了它的查询记录导致无法读到数据。</li> <li>幻读：一个事务在读取它的查询结果时，发现读到了被另一个事务提交的新数据。</li></ul> <div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token comment">-- 设置全局默认的事务隔离级别</span>
<span class="token keyword">set</span> <span class="token keyword">global</span> <span class="token keyword">transaction</span> <span class="token keyword">isolation</span> <span class="token keyword">level</span> <span class="token keyword">repeatable</span> <span class="token keyword">read</span><span class="token punctuation">;</span>
<span class="token comment">-- 设置当前会话的事务隔离级别</span>
<span class="token keyword">set</span> <span class="token keyword">session</span> <span class="token keyword">transaction</span> <span class="token keyword">isolation</span> <span class="token keyword">level</span> <span class="token keyword">read</span> <span class="token keyword">committed</span><span class="token punctuation">;</span>
<span class="token comment">-- 查询当前会话的事务隔离级别</span>
<span class="token keyword">select</span> @<span class="token variable">@tx_isolation</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>Django中的事务控制。</p> <ul><li><p>给每个请求绑定事务环境（反模式）。</p> <div class="language-Python extra-class"><pre class="language-python"><code>ATOMIC_REQUESTS <span class="token operator">=</span> <span class="token boolean">True</span>
</code></pre></div></li> <li><p>使用事务装饰器（简单易用） - 粗粒度（控制不够精细）。</p> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token decorator annotation punctuation">@transaction<span class="token punctuation">.</span>non_atomic_requests</span>
<span class="token decorator annotation punctuation">@transaction<span class="token punctuation">.</span>atomic</span>
</code></pre></div></li> <li><p>使用上下文语法（细粒度 - 事务控制的范围更加精准）。</p> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token keyword">with</span> transaction<span class="token punctuation">.</span>atomic<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
</code></pre></div></li> <li><p>关闭自动提交使用手动提交。</p> <div class="language-Python extra-class"><pre class="language-python"><code>AUTOCOMMIT <span class="token operator">=</span> <span class="token boolean">False</span>
</code></pre></div><div class="language-Python extra-class"><pre class="language-python"><code>transaction<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
transaction<span class="token punctuation">.</span>rollback<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></li></ul></li></ul></li></ol> <h3 id="url配置"><a href="#url配置" class="header-anchor">#</a> URL配置</h3> <ol><li><p>可以让部分URL只在调试模式下生效。</p> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>conf <span class="token keyword">import</span> settings

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">]</span>

<span class="token keyword">if</span> settings<span class="token punctuation">.</span>DEBUG<span class="token punctuation">:</span>
    urlpatterns <span class="token operator">+=</span> <span class="token punctuation">[</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">]</span>
</code></pre></div></li> <li><p>可以使用命名捕获组捕获路径参数。</p> <div class="language-Python extra-class"><pre class="language-python"><code>url<span class="token punctuation">(</span><span class="token string">r'api/code/(?P&lt;mobile&gt;1[3-9]\d{9})'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
path<span class="token punctuation">(</span><span class="token string">'api/code/&lt;str:mobile&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre></div></li> <li><p>URL配置不关心请求使用的方法（一个视图函数可以处理不同的请求方式）。</p></li> <li><p>如果使用<code>url</code>函数捕获的路径参数都是字符串，<code>path</code>函数可以指定路径参数类型。</p></li> <li><p>可以使用<code>include</code>函数引入其他URL配置并指定<code>namespace</code>来解决命名冲突，捕获的参数会向下传递。</p></li> <li><p>在<code>url</code>和<code>path</code>函数甚至是<code>include</code>函数中都可以用字典向视图传入额外的参数，如果参数与捕获的参数同名，则使用字典中的参数。</p></li> <li><p>可以用<code>reverse</code>函数实现URL的逆向解析（从名字解析出URL），在模板中也可以用<code>{% url %}</code>实现同样的操作。</p> <div class="language-Python extra-class"><pre class="language-python"><code>path<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>index<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'index'</span><span class="token punctuation">)</span>

<span class="token keyword">return</span> redirect<span class="token punctuation">(</span>reverse<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span>
</code></pre></div></li></ol> <h2 id="模板-view"><a href="#模板-view" class="header-anchor">#</a> 模板(View)</h2> <h3 id="后端渲染"><a href="#后端渲染" class="header-anchor">#</a> 后端渲染</h3> <ol><li><p>模板的配置和渲染函数。</p> <div class="language-Python extra-class"><pre class="language-python"><code>TEMPLATES <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">'BACKEND'</span><span class="token punctuation">:</span> <span class="token string">'django.template.backends.django.DjangoTemplates'</span><span class="token punctuation">,</span>
        <span class="token string">'DIRS'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>BASE_DIR<span class="token punctuation">,</span> <span class="token string">'templates'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'APP_DIRS'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
        <span class="token string">'OPTIONS'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">'context_processors'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token string">'django.template.context_processors.debug'</span><span class="token punctuation">,</span>
                <span class="token string">'django.template.context_processors.request'</span><span class="token punctuation">,</span>
                <span class="token string">'django.contrib.auth.context_processors.auth'</span><span class="token punctuation">,</span>
                <span class="token string">'django.contrib.messages.context_processors.messages'</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div><div class="language-Python extra-class"><pre class="language-python"><code>resp <span class="token operator">=</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'index.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'foo'</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>模板遇到变量名的查找顺序。</p> <ul><li>字典查找（如：<code>foo['bar']</code>）</li> <li>属性查找（如：<code>foo.bar</code>）</li> <li>方法调用（如：<code>foo.bar()</code>）
<ul><li>方法不能有必须传值的参数</li> <li>在模板中不能够给方法传参</li> <li>如果方法的<code>alters_data</code>被设置为<code>True</code>则不能调用该方法（避免误操作的风险），模型对象动态生成的<code>delete()</code>和<code>save()</code>方法都设定了<code>alters_data = True</code>。</li></ul></li> <li>列表索引查找（如：<code>foo[0]</code>）</li></ul></li> <li><p>模板标签的使用。</p> <ul><li><code>{% if %}</code> / <code>{% else %}</code> / <code>{% endif %}</code></li> <li><code>{% for %}</code> / <code>{% endfor %}</code></li> <li><code>{% ifequal %}</code> / <code>{% endifequal %}</code> / <code>{% ifnotequal %}</code> / <code>{% endifnotequal %}</code></li> <li><code>{# comment #}</code> / <code>{% comment %}</code> / <code>{% endcomment %}</code></li></ul></li> <li><p>过滤器的使用。</p> <ul><li><code>lower</code> / <code>upper</code> / <code>first</code> / <code>last</code> / <code>truncatewords</code> / <code>date</code>/ <code>time</code> / <code>length</code> / <code>pluralize</code> / <code>center</code> / <code>ljust</code> / <code>rjust</code> / <code>cut</code> / <code>urlencode</code> / <code>default_if_none</code> / <code>filesizeformat</code> / <code>join</code> / <code>slice</code> / <code>slugify</code></li></ul></li> <li><p>模板的包含和继承。</p> <ul><li><code>{% include %}</code> / <code>{% block %}</code></li> <li><code>{% extends %}</code></li></ul></li> <li><p>模板加载器（后面优化部分会讲到）。</p> <ul><li><p>文件系统加载器</p> <div class="language-Python extra-class"><pre class="language-python"><code>TEMPLATES <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token string">'BACKEND'</span><span class="token punctuation">:</span> <span class="token string">'django.template.backends.django.DjangoTemplates'</span><span class="token punctuation">,</span>
    <span class="token string">'DIRS'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>BASE_DIR<span class="token punctuation">,</span> <span class="token string">'templates'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre></div></li> <li><p>应用目录加载器</p> <div class="language-Python extra-class"><pre class="language-python"><code>TEMPLATES <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token string">'BACKEND'</span><span class="token punctuation">:</span> <span class="token string">'django.template.backends.django.DjangoTemplates'</span><span class="token punctuation">,</span>
    <span class="token string">'APP_DIRS'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre></div></li></ul></li></ol> <h3 id="前端渲染"><a href="#前端渲染" class="header-anchor">#</a> 前端渲染</h3> <ol><li>前端模板引擎：Handlebars / Mustache。</li> <li>前端MV*框架。
<ul><li>MVC - AngularJS</li> <li>MVVM(Model-View-ViewModel) - Vue.js</li></ul></li></ol> <h3 id="其他视图"><a href="#其他视图" class="header-anchor">#</a> 其他视图</h3> <ol><li><p>MIME（多用途Internet邮件扩展）类型 - 告知浏览器传输的数据类型。</p> <table><thead><tr><th>Content-Type</th> <th>说明</th></tr></thead> <tbody><tr><td>application/json</td> <td><a href="https://zh.wikipedia.org/wiki/JSON" target="_blank" rel="noopener noreferrer">JSON<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>（JavaScript Object Notation）</td></tr> <tr><td>application/pdf</td> <td><a href="https://zh.wikipedia.org/wiki/PDF" target="_blank" rel="noopener noreferrer">PDF<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>（Portable Document Format）</td></tr> <tr><td>audio/mpeg</td> <td><a href="https://zh.wikipedia.org/wiki/MP3" target="_blank" rel="noopener noreferrer">MP3<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>或其他<a href="https://zh.wikipedia.org/wiki/MPEG" target="_blank" rel="noopener noreferrer">MPEG<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>音频文件</td></tr> <tr><td>audio/vnd.wave</td> <td><a href="https://zh.wikipedia.org/wiki/WAV" target="_blank" rel="noopener noreferrer">WAV<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>音频文件</td></tr> <tr><td>image/gif</td> <td><a href="https://zh.wikipedia.org/wiki/GIF" target="_blank" rel="noopener noreferrer">GIF<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>图像文件</td></tr> <tr><td>image/jpeg</td> <td><a href="https://zh.wikipedia.org/wiki/JPEG" target="_blank" rel="noopener noreferrer">JPEG<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>图像文件</td></tr> <tr><td>image/png</td> <td><a href="https://zh.wikipedia.org/wiki/PNG" target="_blank" rel="noopener noreferrer">PNG<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>图像文件</td></tr> <tr><td>text/html</td> <td><a href="https://zh.wikipedia.org/wiki/HTML" target="_blank" rel="noopener noreferrer">HTML<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>文件</td></tr> <tr><td>text/xml</td> <td><a href="https://zh.wikipedia.org/wiki/XML" target="_blank" rel="noopener noreferrer">XML<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td></tr> <tr><td>video/mp4</td> <td><a href="https://zh.wikipedia.org/wiki/MP4" target="_blank" rel="noopener noreferrer">MP4<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>视频文件</td></tr> <tr><td>video/quicktime</td> <td><a href="https://zh.wikipedia.org/wiki/QuickTime" target="_blank" rel="noopener noreferrer">QuickTime<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>视频文件</td></tr></tbody></table></li> <li><p>如何处置生成的内容（inline / attachment）。</p> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> urllib<span class="token punctuation">.</span>parse <span class="token keyword">import</span> quote
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> response<span class="token punctuation">[</span><span class="token string">'content-type'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'application/pdf'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> filename <span class="token operator">=</span> quote<span class="token punctuation">(</span><span class="token string">'Python语言规范.pdf'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> filename
<span class="token string">'Python%E8%AF%AD%E8%A8%80%E8%A7%84%E8%8C%83.pdf'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> response<span class="token punctuation">[</span><span class="token string">'content-disposition'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'attachment; filename=&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>filename<span class="token punctuation">}</span></span><span class="token string">&quot;'</span></span>
</code></pre></div><blockquote><p>提醒：URL以及请求和响应头中的中文都应该处理成<a href="https://zh.wikipedia.org/zh-hans/%E7%99%BE%E5%88%86%E5%8F%B7%E7%BC%96%E7%A0%81" target="_blank" rel="noopener noreferrer">百分号编码<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p></blockquote></li> <li><p>生成CSV / Excel / PDF / 统计报表。</p> <ul><li><p>向浏览器传输二进制数据。</p> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> io <span class="token keyword">import</span> BytesIO

<span class="token builtin">buffer</span> <span class="token operator">=</span> BytesIO<span class="token punctuation">(</span><span class="token punctuation">)</span>

resp <span class="token operator">=</span> HttpResponse<span class="token punctuation">(</span>content_type<span class="token operator">=</span><span class="token string">'...'</span><span class="token punctuation">)</span>
resp<span class="token punctuation">[</span><span class="token string">'Content-Disposition'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'attachment; filename=&quot;...&quot;'</span>
resp<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">buffer</span><span class="token punctuation">.</span>getvalue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-Python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> io <span class="token keyword">import</span> BytesIO

<span class="token keyword">import</span> xlwt


<span class="token keyword">def</span> <span class="token function">get_style</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> bold<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> italic<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    font <span class="token operator">=</span> xlwt<span class="token punctuation">.</span>Font<span class="token punctuation">(</span><span class="token punctuation">)</span>
    font<span class="token punctuation">.</span>name<span class="token punctuation">,</span> font<span class="token punctuation">.</span>colour_index<span class="token punctuation">,</span> font<span class="token punctuation">.</span>bold<span class="token punctuation">,</span> font<span class="token punctuation">.</span>italic <span class="token operator">=</span> \
    	name<span class="token punctuation">,</span> color<span class="token punctuation">,</span> bold<span class="token punctuation">,</span> italic
    style <span class="token operator">=</span> xlwt<span class="token punctuation">.</span>XFStyle<span class="token punctuation">(</span><span class="token punctuation">)</span>
    style<span class="token punctuation">.</span>font <span class="token operator">=</span> font
    <span class="token keyword">return</span> style


<span class="token keyword">def</span> <span class="token function">export_emp_excel</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 创建Excel工作簿(使用三方库xlwt)</span>
    workbook <span class="token operator">=</span> xlwt<span class="token punctuation">.</span>Workbook<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 向工作簿中添加工作表</span>
    sheet <span class="token operator">=</span> workbook<span class="token punctuation">.</span>add_sheet<span class="token punctuation">(</span><span class="token string">'员工详细信息'</span><span class="token punctuation">)</span>
    <span class="token comment"># 设置表头</span>
    titles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'编号'</span><span class="token punctuation">,</span> <span class="token string">'姓名'</span><span class="token punctuation">,</span> <span class="token string">'主管'</span><span class="token punctuation">,</span> <span class="token string">'职位'</span><span class="token punctuation">,</span> <span class="token string">'工资'</span><span class="token punctuation">,</span> <span class="token string">'部门名称'</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> col<span class="token punctuation">,</span> title <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>titles<span class="token punctuation">)</span><span class="token punctuation">:</span>
        sheet<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> col<span class="token punctuation">,</span> title<span class="token punctuation">,</span> get_style<span class="token punctuation">(</span><span class="token string">'HanziPenSC-W3'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># 使用Django的ORM框架查询员工数据</span>
    emps <span class="token operator">=</span> Emp<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>select_related<span class="token punctuation">(</span><span class="token string">'dept'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>select_related<span class="token punctuation">(</span><span class="token string">'mgr'</span><span class="token punctuation">)</span>
    cols <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'no'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'mgr'</span><span class="token punctuation">,</span> <span class="token string">'job'</span><span class="token punctuation">,</span> <span class="token string">'sal'</span><span class="token punctuation">,</span> <span class="token string">'dept'</span><span class="token punctuation">]</span>
    <span class="token comment"># 通过嵌套的循环将员工表的数据写入Excel工作表的单元格</span>
    <span class="token keyword">for</span> row<span class="token punctuation">,</span> emp <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>emps<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> col<span class="token punctuation">,</span> prop <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>cols<span class="token punctuation">)</span><span class="token punctuation">:</span>
            val <span class="token operator">=</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>emp<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> <span class="token punctuation">(</span>Dept<span class="token punctuation">,</span> Emp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                val <span class="token operator">=</span> val<span class="token punctuation">.</span>name
            sheet<span class="token punctuation">.</span>write<span class="token punctuation">(</span>row <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> col<span class="token punctuation">,</span> val<span class="token punctuation">)</span>
    <span class="token comment"># 将Excel文件的二进制数据写入内存</span>
    <span class="token builtin">buffer</span> <span class="token operator">=</span> BytesIO<span class="token punctuation">(</span><span class="token punctuation">)</span>
    workbook<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token builtin">buffer</span><span class="token punctuation">)</span>
    <span class="token comment"># 通过HttpResponse对象向浏览器输出Excel文件</span>
    resp <span class="token operator">=</span> HttpResponse<span class="token punctuation">(</span><span class="token builtin">buffer</span><span class="token punctuation">.</span>getvalue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    resp<span class="token punctuation">[</span><span class="token string">'content-type'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'application/msexcel'</span>
    <span class="token comment"># 如果文件名有中文需要处理成百分号编码</span>
    resp<span class="token punctuation">[</span><span class="token string">'content-disposition'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'attachment; filename=&quot;detail.xls&quot;'</span>
    <span class="token keyword">return</span> resp
</code></pre></div></li> <li><p>大文件的流式处理：<code>StreamingHttpResponse</code>。</p> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">download_file</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    file_stream <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'...'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span>
    <span class="token comment"># 如果文件的二进制数据较大则最好用迭代器进行处理避免过多的占用服务器内存</span>
    file_iter <span class="token operator">=</span> <span class="token builtin">iter</span><span class="token punctuation">(</span><span class="token keyword">lambda</span><span class="token punctuation">:</span> file_stream<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token number">4096</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">b''</span><span class="token punctuation">)</span>
    resp <span class="token operator">=</span> StreamingHttpResponse<span class="token punctuation">(</span>file_iter<span class="token punctuation">)</span>
    <span class="token comment"># 中文文件名要处理成百分号编码</span>
    filename <span class="token operator">=</span> quote<span class="token punctuation">(</span><span class="token string">'...'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    resp<span class="token punctuation">[</span><span class="token string">'Content-Type'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'...'</span>
    resp<span class="token punctuation">[</span><span class="token string">'Content-Disposition'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'attachment; filename=&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>filename<span class="token punctuation">}</span></span><span class="token string">&quot;'</span></span>
    <span class="token keyword">return</span> resp
</code></pre></div><blockquote><p>说明：如果需要生成PDF文件，可以需要安装<code>reportlab</code>。另外，使用StreamingHttpResponse只能减少内存的开销，但是如果下载一个大文件会导致一个请求长时间占用服务器资源，比较好的做法还是把报表提前生成好（可以考虑使用定时任务），放在静态资源服务器或者是云存储服务器上以访问静态资源的方式访问。</p></blockquote></li> <li><p><a href="http://echarts.baidu.com/" target="_blank" rel="noopener noreferrer">ECharts<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>或<a href="https://www.chartjs.org/" target="_blank" rel="noopener noreferrer">Chart.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <ul><li>思路：后端只提供JSON格式的数据，前端JavaScript渲染生成图表。</li></ul> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">get_charts_data</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;获取统计图表JSON数据&quot;&quot;&quot;</span>
    names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    totals <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment"># 通过connections获取指定数据库连接并创建游标对象</span>
    <span class="token keyword">with</span> connections<span class="token punctuation">[</span><span class="token string">'backend'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> cursor<span class="token punctuation">:</span>
        <span class="token comment"># 在使用ORM框架时可以使用对象管理器的aggregate()和annotate()方法实现分组和聚合函数查询</span>
        <span class="token comment"># 执行原生SQL查询(如果ORM框架不能满足业务或性能需求)</span>
        cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'select dname, total from vw_dept_emp'</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> row <span class="token keyword">in</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            names<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            totals<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> JsonResponse<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'names'</span><span class="token punctuation">:</span> names<span class="token punctuation">,</span> <span class="token string">'totals'</span><span class="token punctuation">:</span> totals<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-HTML extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>统计图表<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
        <span class="token selector">#main</span> <span class="token punctuation">{</span>
            <span class="token property">width</span><span class="token punctuation">:</span> 600px<span class="token punctuation">;</span>
            <span class="token property">height</span><span class="token punctuation">:</span> 400px<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>main<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.bootcss.com/echarts/4.2.0-rc.2/echarts.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        <span class="token keyword">var</span> myChart <span class="token operator">=</span> echarts<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#main'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token string">'url'</span><span class="token operator">:</span> <span class="token string">'charts_data'</span><span class="token punctuation">,</span>
            <span class="token string">'type'</span><span class="token operator">:</span> <span class="token string">'get'</span><span class="token punctuation">,</span>
            <span class="token string">'data'</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">'dataType'</span><span class="token operator">:</span> <span class="token string">'json'</span><span class="token punctuation">,</span>
            <span class="token string">'success'</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">json</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">var</span> option <span class="token operator">=</span> <span class="token punctuation">{</span>
                    title<span class="token operator">:</span> <span class="token punctuation">{</span>
                        text<span class="token operator">:</span> <span class="token string">'员工分布统计图'</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    tooltip<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                    legend<span class="token operator">:</span> <span class="token punctuation">{</span>
                        data<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'人数'</span><span class="token punctuation">]</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    xAxis<span class="token operator">:</span> <span class="token punctuation">{</span>
                        data<span class="token operator">:</span> json<span class="token punctuation">.</span>names
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    yAxis<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                    series<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
                        name<span class="token operator">:</span> <span class="token string">'人数'</span><span class="token punctuation">,</span>
                        type<span class="token operator">:</span> <span class="token string">'bar'</span><span class="token punctuation">,</span>
                        data<span class="token operator">:</span> json<span class="token punctuation">.</span>totals
                    <span class="token punctuation">}</span><span class="token punctuation">]</span>
                <span class="token punctuation">}</span><span class="token punctuation">;</span>
                myChart<span class="token punctuation">.</span><span class="token function">setOption</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">'error'</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ul></li></ol> <h2 id="中间件"><a href="#中间件" class="header-anchor">#</a> 中间件</h2> <p>问题1：中间件背后的设计理念是什么？（分离横切关注功能/拦截过滤器模式）</p> <p>问题2：中间件有哪些不同的实现方式？（参考下面的代码）</p> <p>问题3：描述Django内置的中间件及其执行顺序。（推荐阅读：<a href="https://docs.djangoproject.com/zh-hans/2.0/ref/middleware/#middleware-ordering" target="_blank" rel="noopener noreferrer">Django官方文档 - 中间件 - 中间件顺序<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>）</p> <h3 id="激活中间件"><a href="#激活中间件" class="header-anchor">#</a> 激活中间件</h3> <div class="language-Python extra-class"><pre class="language-python"><code>MIDDLEWARE <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'django.middleware.security.SecurityMiddleware'</span><span class="token punctuation">,</span>
    <span class="token string">'django.contrib.sessions.middleware.SessionMiddleware'</span><span class="token punctuation">,</span>
    <span class="token string">'django.middleware.common.CommonMiddleware'</span><span class="token punctuation">,</span>
    <span class="token string">'django.middleware.csrf.CsrfViewMiddleware'</span><span class="token punctuation">,</span>
    <span class="token string">'django.contrib.auth.middleware.AuthenticationMiddleware'</span><span class="token punctuation">,</span>
    <span class="token string">'django.contrib.messages.middleware.MessageMiddleware'</span><span class="token punctuation">,</span>
    <span class="token string">'django.middleware.clickjacking.XFrameOptionsMiddleware'</span><span class="token punctuation">,</span>
    <span class="token string">'common.middlewares.block_sms_middleware'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div><h3 id="自定义中间件"><a href="#自定义中间件" class="header-anchor">#</a> 自定义中间件</h3> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">simple_middleware</span><span class="token punctuation">(</span>get_response<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token keyword">def</span> <span class="token function">middleware</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        
		response <span class="token operator">=</span> get_response<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
        
		<span class="token keyword">return</span> response
    
    <span class="token keyword">return</span> middleware
</code></pre></div><div class="language-Python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">MyMiddleware</span><span class="token punctuation">:</span>
        
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> get_response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>get_response <span class="token operator">=</span> get_response
        
    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        
        response <span class="token operator">=</span> self<span class="token punctuation">.</span>get_response<span class="token punctuation">(</span>request<span class="token punctuation">)</span>
       
        <span class="token keyword">return</span> response
</code></pre></div><div class="language-Python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">MyMiddleware</span><span class="token punctuation">(</span>MiddlewareMixin<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
    
    <span class="token keyword">def</span> <span class="token function">process_request</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
    
    <span class="token keyword">def</span> <span class="token function">process_view</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> view_func<span class="token punctuation">,</span> view_args<span class="token punctuation">,</span> view_kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
    
    <span class="token keyword">def</span> <span class="token function">process_template_response</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
    
    <span class="token keyword">def</span> <span class="token function">process_response</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
    
    <span class="token keyword">def</span> <span class="token function">process_exception</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> exception<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
</code></pre></div><h3 id="内置中间件"><a href="#内置中间件" class="header-anchor">#</a> 内置中间件</h3> <ol><li><p>CommonMiddleware - 基础设置中间件</p> <ul><li>DISALLOWED_USER_AGENTS - 不被允许的用户代理（浏览器）</li> <li>APPEND_SLASH - 是否追加<code>/</code></li> <li>USE_ETAG - 浏览器缓存相关</li></ul></li> <li><p>SecurityMiddleware - 安全相关中间件</p> <ul><li>SECURE_HSTS_SECONDS - 强制使用HTTPS的时间</li> <li>SECURE_HSTS_INCLUDE_SUBDOMAINS - HTTPS是否覆盖子域名</li> <li>SECURE_CONTENT_TYPE_NOSNIFF - 是否允许浏览器推断内容类型</li> <li>SECURE_BROWSER_XSS_FILTER - 是否启用跨站脚本攻击过滤器</li> <li>SECURE_SSL_REDIRECT - 是否重定向到HTTPS连接</li> <li>SECURE_REDIRECT_EXEMPT - 免除重定向到HTTPS</li></ul></li> <li><p>SessionMiddleware - 会话中间件</p></li> <li><p>CsrfViewMiddleware - 防范跨站身份伪造中间件</p></li> <li><p>XFrameOptionsMiddleware - 防范点击劫持攻击中间件</p> <img src="https://cdn.jsdelivr.net/gh/wuKongNotNull/images-hosting/wukong-website/click-jacking.png" style="zoom:50%;"></li></ol> <img src="https://cdn.jsdelivr.net/gh/wuKongNotNull/images-hosting/wukong-website/builtin-middlewares.png" style="zoom:50%;"> <h2 id="表单"><a href="#表单" class="header-anchor">#</a> 表单</h2> <ol><li>用法：通常不要用来生成页面上的表单控件（耦合度太高不容易定制），主要用来验证数据。</li> <li>Form的属性和方法：
<ul><li><code>is_valid()</code> / <code>is_multipart()</code></li> <li><code>errors</code> / <code>fields</code> / <code>is_bound</code> / <code>changed_data</code> / <code>cleaned_data</code></li> <li><code>add_error()</code> / <code>has_errors()</code> / <code>non_field_errors()</code></li> <li><code>clean()</code></li></ul></li> <li>Form.errors的方法：
<ul><li><code>as_data()</code> / <code>as_json()</code> / <code>get_json_data()</code></li></ul></li></ol> <p>问题1：Django中的<code>Form</code>和<code>ModelForm</code>有什么作用？（通常不用来生成表单主要用来验证数据）</p> <p>问题2：表单上传文件时应该注意哪些问题？（表单的设置、多文件上传、图片预览（FileReader）、Ajax上传文件、上传后的文件如何存储、调用云存储（如<a href="https://www.aliyun.com/product/oss" target="_blank" rel="noopener noreferrer">阿里云OSS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>、<a href="https://www.qiniu.com/" target="_blank" rel="noopener noreferrer">七牛云<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>、<a href="https://leancloud.cn/storage/" target="_blank" rel="noopener noreferrer">LeanCloud<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>等））</p> <div class="language-HTML extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>multipart/form-data<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>...<span class="token punctuation">&quot;</span></span> <span class="token attr-name">multiple</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>foo<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>foo<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>foo<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><blockquote><p>说明：上传图片文件的预览效果可以通过HTML5的FileReader来实现。</p></blockquote> <blockquote><p>说明：使用云存储通常是比自己配置分布式文件系统这种方式更靠谱的做法，而且云存储通常成本并不太高，不仅如此大多数云存储还提供了如图片剪裁、生成水印、视频转码、CDN等服务。如果要自己做上传的视频文件转码，需要安装三方库ffmpeg，在程序中调用该三方库可以实现转码。</p></blockquote> <h2 id="cookie和session"><a href="#cookie和session" class="header-anchor">#</a> Cookie和Session</h2> <p>问题1：使用Cookie能解决什么问题？（用户跟踪，解决HTTP协议无状态问题）</p> <ol><li><p>URL重写</p> <div class="language- extra-class"><pre class="language-text"><code>http://www.abc.com/path/resource?foo=bar
</code></pre></div></li> <li><p>隐藏域（隐式表单域）- 埋点</p> <div class="language-HTML extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>foo<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bar<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>Cookie - 浏览器中的临时文件（文本文件）- BASE64</p></li></ol> <p>问题2：Cookie和Session之间关系是什么？（Session的标识通过Cookie保存和传输）</p> <h3 id="session的配置"><a href="#session的配置" class="header-anchor">#</a> Session的配置</h3> <ol><li><p>Session对应的中间件：<code>django.contrib.sessions.middleware.SessionMiddleware</code>。</p></li> <li><p>Session引擎。</p> <ul><li><p>基于数据库（默认方式）</p> <div class="language-Python extra-class"><pre class="language-python"><code>INSTALLED_APPS <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'django.contrib.sessions'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div></li> <li><p>基于缓存（推荐使用）</p> <div class="language-Python extra-class"><pre class="language-python"><code>SESSION_ENGINE <span class="token operator">=</span> <span class="token string">'django.contrib.sessions.backends.cache'</span>
SESSION_CACHE_ALIAS <span class="token operator">=</span> <span class="token string">'session'</span>
</code></pre></div></li> <li><p>基于文件（基本不考虑）</p></li> <li><p>基于Cookie（不靠谱）</p> <div class="language-Python extra-class"><pre class="language-python"><code>SESSION_ENGINE <span class="token operator">=</span> <span class="token string">'django.contrib.sessions.backends.signed_cookies'</span>
</code></pre></div></li></ul></li> <li><p>Cookie相关的配置。</p> <div class="language-Python extra-class"><pre class="language-python"><code>SESSION_COOKIE_NAME <span class="token operator">=</span> <span class="token string">'djang_session_id'</span>
SESSION_COOKIE_AGE <span class="token operator">=</span> <span class="token number">1209600</span>
<span class="token comment"># 如果设置为True，Cookie就是基于浏览器窗口的Cookie，不会持久化</span>
SESSION_EXPIRE_AT_BROWSER_CLOSE <span class="token operator">=</span> <span class="token boolean">False</span> 
SESSION_SAVE_EVERY_REQUEST <span class="token operator">=</span> <span class="token boolean">False</span>
SESSION_COOKIE_HTTPONLY <span class="token operator">=</span> <span class="token boolean">True</span>
</code></pre></div></li> <li><p>session的属性和方法。</p> <ul><li><code>session_key</code> / <code>session_data</code> / <code>expire_date</code></li> <li><code>__getitem__</code> / <code>__setitem__</code> / <code>__delitem__</code> / <code>__contains__</code></li> <li><code>set_expiry()</code> / <code>get_expiry_age()</code> / <code>get_expiry_date()</code> - 设置/获取会话超期时间</li> <li><code>flush()</code> - 销毁会话</li> <li><code>set_test_cookie()</code> / <code>test_cookie_worked()</code> / <code>delete_test_cookie()</code> - 测试浏览器是否支持Cookie（提示用户如果浏览器禁用Cookie可能会影响网站的使用）</li></ul></li> <li><p>session的序列化。</p> <div class="language-Python extra-class"><pre class="language-python"><code>SESSION_SERIALIZER <span class="token operator">=</span> <span class="token string">'django.contrib.sessions.serializers.JSONSerializer'</span>
</code></pre></div><ul><li><p>JSONSerializer（1.6及以后默认）- 如果想将自定义的对象放到session中，会遇到“Object of type 'XXX' is not JSON serializable”的问题（如果配置使用Redis保存Session，django-redis使用了Pickle序列化，这个问题就不存在了）。</p></li> <li><p>PickleSerializer（1.6以前的默认）- 因为安全问题不推荐使用，但是只要不去反序列化用户构造的恶意的Payload其实也没有什么风险。关于这种方式的安全漏洞，可以参考《<a href="http://www.polaris-lab.com/index.php/archives/178/" target="_blank" rel="noopener noreferrer">Python Pickle的任意代码执行漏洞实践和Payload构造》<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>一文或《软件架构-Python语言实现》上关于这个问题的讲解。</p> <blockquote><p>说明：如果使用了django_redis整合Redis作为session的存储引擎，那么由于django_redis又封装了一个PickleSerializer来提供序列化，所以不会存在上述的问题，且Redis中保存的value是pickle序列化之后的结果。</p></blockquote></li></ul></li></ol> <h2 id="缓存"><a href="#缓存" class="header-anchor">#</a> 缓存</h2> <h3 id="配置缓存"><a href="#配置缓存" class="header-anchor">#</a> 配置缓存</h3> <div class="language-Python extra-class"><pre class="language-python"><code>CACHES <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment"># 默认缓存</span>
    <span class="token string">'default'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">'BACKEND'</span><span class="token punctuation">:</span> <span class="token string">'django_redis.cache.RedisCache'</span><span class="token punctuation">,</span>
        <span class="token string">'LOCATION'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token string">'redis://1.2.3.4:6379/0'</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'KEY_PREFIX'</span><span class="token punctuation">:</span> <span class="token string">'teamproject'</span><span class="token punctuation">,</span>
        <span class="token string">'OPTIONS'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">'CLIENT_CLASS'</span><span class="token punctuation">:</span> <span class="token string">'django_redis.client.DefaultClient'</span><span class="token punctuation">,</span>
            <span class="token string">'CONNECTION_POOL_KWARGS'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                <span class="token string">'max_connections'</span><span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">'PASSWORD'</span><span class="token punctuation">:</span> <span class="token string">'yourpass'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment"># 页面缓存</span>
    <span class="token string">'page'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">'BACKEND'</span><span class="token punctuation">:</span> <span class="token string">'django_redis.cache.RedisCache'</span><span class="token punctuation">,</span>
        <span class="token string">'LOCATION'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token string">'redis://1.2.3.4:6379/1'</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'KEY_PREFIX'</span><span class="token punctuation">:</span> <span class="token string">'teamproject:page'</span><span class="token punctuation">,</span>
        <span class="token string">'OPTIONS'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">'CLIENT_CLASS'</span><span class="token punctuation">:</span> <span class="token string">'django_redis.client.DefaultClient'</span><span class="token punctuation">,</span>
            <span class="token string">'CONNECTION_POOL_KWARGS'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                <span class="token string">'max_connections'</span><span class="token punctuation">:</span> <span class="token number">500</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">'PASSWORD'</span><span class="token punctuation">:</span> <span class="token string">'yourpass'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment"># 会话缓存</span>
    <span class="token string">'session'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">'BACKEND'</span><span class="token punctuation">:</span> <span class="token string">'django_redis.cache.RedisCache'</span><span class="token punctuation">,</span>
        <span class="token string">'LOCATION'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token string">'redis://1.2.3.4:6379/2'</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'KEY_PREFIX'</span><span class="token punctuation">:</span> <span class="token string">'teamproject:session'</span><span class="token punctuation">,</span>
        <span class="token string">'TIMEOUT'</span><span class="token punctuation">:</span> <span class="token number">1209600</span><span class="token punctuation">,</span>
        <span class="token string">'OPTIONS'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">'CLIENT_CLASS'</span><span class="token punctuation">:</span> <span class="token string">'django_redis.client.DefaultClient'</span><span class="token punctuation">,</span>
            <span class="token string">'CONNECTION_POOL_KWARGS'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                <span class="token string">'max_connections'</span><span class="token punctuation">:</span> <span class="token number">2000</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">'PASSWORD'</span><span class="token punctuation">:</span> <span class="token string">'yourpass'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment"># 接口数据缓存</span>
    <span class="token string">'api'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">'BACKEND'</span><span class="token punctuation">:</span> <span class="token string">'django_redis.cache.RedisCache'</span><span class="token punctuation">,</span>
        <span class="token string">'LOCATION'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token string">'redis://1.2.3.4:6379/3'</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'KEY_PREFIX'</span><span class="token punctuation">:</span> <span class="token string">'teamproject:api'</span><span class="token punctuation">,</span>
        <span class="token string">'OPTIONS'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">'CLIENT_CLASS'</span><span class="token punctuation">:</span> <span class="token string">'django_redis.client.DefaultClient'</span><span class="token punctuation">,</span>
            <span class="token string">'CONNECTION_POOL_KWARGS'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                <span class="token string">'max_connections'</span><span class="token punctuation">:</span> <span class="token number">500</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">'PASSWORD'</span><span class="token punctuation">:</span> <span class="token string">'yourpass'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>说明：通过Redis底层提供的多个数据库来隔离缓存数据有助于缓存数据的管理。如果配置了Redis的主从复制（读写分离），LOCATION列表中可以配置多个Redis连接，第一个被视为master用来进行写操作，后面的被视为slave用来进行读操作。</p></blockquote> <h3 id="全站缓存"><a href="#全站缓存" class="header-anchor">#</a> 全站缓存</h3> <div class="language-Python extra-class"><pre class="language-python"><code>MIDDLEWARE_CLASSES <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'django.middleware.cache.UpdateCacheMiddleware'</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token string">'django.middleware.common.CommonMiddleware'</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token string">'django.middleware.cache.FetchFromCacheMiddleware'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

CACHE_MIDDLEWARE_ALIAS <span class="token operator">=</span> <span class="token string">'default'</span>
CACHE_MIDDLEWARE_SECONDS <span class="token operator">=</span> <span class="token number">300</span>
CACHE_MIDDLEWARE_KEY_PREFIX <span class="token operator">=</span> <span class="token string">'djang:cache'</span>
</code></pre></div><h3 id="视图层缓存"><a href="#视图层缓存" class="header-anchor">#</a> 视图层缓存</h3> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>views<span class="token punctuation">.</span>decorators<span class="token punctuation">.</span>cache <span class="token keyword">import</span> cache_page
<span class="token keyword">from</span> django<span class="token punctuation">.</span>views<span class="token punctuation">.</span>decorators<span class="token punctuation">.</span>vary <span class="token keyword">import</span> vary_on_cookie


<span class="token decorator annotation punctuation">@cache_page</span><span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">60</span> <span class="token operator">*</span> <span class="token number">15</span><span class="token punctuation">,</span> cache<span class="token operator">=</span><span class="token string">'page'</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@vary_on_cookie</span>
<span class="token keyword">def</span> <span class="token function">my_view</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
</code></pre></div><div class="language-Python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>views<span class="token punctuation">.</span>decorators<span class="token punctuation">.</span>cache <span class="token keyword">import</span> cache_page

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    url<span class="token punctuation">(</span><span class="token string">r'^foo/([0-9]{1,2})/$'</span><span class="token punctuation">,</span> cache_page<span class="token punctuation">(</span><span class="token number">60</span> <span class="token operator">*</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">(</span>my_view<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div><h3 id="其他内容"><a href="#其他内容" class="header-anchor">#</a> 其他内容</h3> <ol><li><p>模板片段缓存。</p> <ul><li><code>{% load cache %}</code></li> <li><code>{% cache %}</code> / <code>{% endcache %}</code></li></ul></li> <li><p>使用底层API访问缓存。</p> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>cache <span class="token keyword">import</span> cache
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> cache<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">'my_key'</span><span class="token punctuation">,</span> <span class="token string">'hello, world!'</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> cache<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'my_key'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> cache<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-Python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>cache <span class="token keyword">import</span> caches
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> cache1 <span class="token operator">=</span> caches<span class="token punctuation">[</span><span class="token string">'page'</span><span class="token punctuation">]</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> cache2 <span class="token operator">=</span> caches<span class="token punctuation">[</span><span class="token string">'page'</span><span class="token punctuation">]</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> cache1 <span class="token keyword">is</span> cache2
<span class="token boolean">True</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> cache3 <span class="token operator">=</span> caches<span class="token punctuation">[</span><span class="token string">'session'</span><span class="token punctuation">]</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> cache2 <span class="token keyword">is</span> cache3
<span class="token boolean">False</span>
</code></pre></div><div class="language-Python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> django_redis <span class="token keyword">import</span> get_redis_connection
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> redis_client <span class="token operator">=</span> get_redis_connection<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> redis_client<span class="token punctuation">.</span>hgetall<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></li></ol> <h2 id="日志"><a href="#日志" class="header-anchor">#</a> 日志</h2> <h3 id="日志级别"><a href="#日志级别" class="header-anchor">#</a> 日志级别</h3> <p>NOTSET &lt; DEBUG &lt; INFO &lt; WARNING &lt; ERROR &lt; CRITICAL</p> <h3 id="日志配置"><a href="#日志配置" class="header-anchor">#</a> 日志配置</h3> <div class="language-Python extra-class"><pre class="language-python"><code>LOGGING <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'version'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token string">'disable_existing_loggers'</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">,</span>
    <span class="token comment"># 配置日志格式化器</span>
    <span class="token string">'formatters'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">'simple'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">'format'</span><span class="token punctuation">:</span> <span class="token string">'%(asctime)s %(module)s.%(funcName)s: %(message)s'</span><span class="token punctuation">,</span>
            <span class="token string">'datefmt'</span><span class="token punctuation">:</span> <span class="token string">'%Y-%m-%d %H:%M:%S'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">'verbose'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">'format'</span><span class="token punctuation">:</span> <span class="token string">'%(asctime)s %(levelname)s [%(process)d-%(threadName)s] '</span>
                      <span class="token string">'%(module)s.%(funcName)s line %(lineno)d: %(message)s'</span><span class="token punctuation">,</span>
            <span class="token string">'datefmt'</span><span class="token punctuation">:</span> <span class="token string">'%Y-%m-%d %H:%M:%S'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment"># 配置日志过滤器</span>
    <span class="token string">'filters'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">'require_debug_true'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">'()'</span><span class="token punctuation">:</span> <span class="token string">'django.utils.log.RequireDebugTrue'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment"># 配置日志处理器</span>
    <span class="token string">'handlers'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">'console'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'logging.StreamHandler'</span><span class="token punctuation">,</span>
            <span class="token string">'level'</span><span class="token punctuation">:</span> <span class="token string">'DEBUG'</span><span class="token punctuation">,</span>
            <span class="token string">'filters'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'require_debug_true'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'formatter'</span><span class="token punctuation">:</span> <span class="token string">'simple'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">'file1'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'logging.handlers.TimedRotatingFileHandler'</span><span class="token punctuation">,</span>
            <span class="token string">'filename'</span><span class="token punctuation">:</span> <span class="token string">'access.log'</span><span class="token punctuation">,</span>
            <span class="token string">'when'</span><span class="token punctuation">:</span> <span class="token string">'W0'</span><span class="token punctuation">,</span>
            <span class="token string">'backupCount'</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
            <span class="token string">'formatter'</span><span class="token punctuation">:</span> <span class="token string">'simple'</span><span class="token punctuation">,</span>
            <span class="token string">'level'</span><span class="token punctuation">:</span> <span class="token string">'INFO'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">'file2'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'logging.handlers.TimedRotatingFileHandler'</span><span class="token punctuation">,</span>
            <span class="token string">'filename'</span><span class="token punctuation">:</span> <span class="token string">'error.log'</span><span class="token punctuation">,</span>
            <span class="token string">'when'</span><span class="token punctuation">:</span> <span class="token string">'D'</span><span class="token punctuation">,</span>
            <span class="token string">'backupCount'</span><span class="token punctuation">:</span> <span class="token number">31</span><span class="token punctuation">,</span>
            <span class="token string">'formatter'</span><span class="token punctuation">:</span> <span class="token string">'verbose'</span><span class="token punctuation">,</span>
            <span class="token string">'level'</span><span class="token punctuation">:</span> <span class="token string">'WARNING'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment"># 配置日志器</span>
    <span class="token string">'loggers'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">'django'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">'handlers'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'console'</span><span class="token punctuation">,</span> <span class="token string">'file1'</span><span class="token punctuation">,</span> <span class="token string">'file2'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'propagate'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
            <span class="token string">'level'</span><span class="token punctuation">:</span> <span class="token string">'DEBUG'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a href="https://docs.djangoproject.com/zh-hans/2.0/topics/logging/#s-examples" target="_blank" rel="noopener noreferrer">日志配置官方示例<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h3 id="日志分析"><a href="#日志分析" class="header-anchor">#</a> 日志分析</h3> <ol><li><p>Linux相关命令：head、tail、grep、awk、uniq、sort</p> <div class="language-Shell extra-class"><pre class="language-shell"><code><span class="token function">tail</span> -10000 access.log <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $1}'</span> <span class="token operator">|</span> <span class="token function">uniq</span> -c <span class="token operator">|</span> <span class="token function">sort</span> -r
</code></pre></div></li> <li><p>实时日志文件分析：Python + 正则表达式 + Crontab</p></li> <li><p><a href="https://github.com/jkklee/web_log_analyse" target="_blank" rel="noopener noreferrer">《Python日志分析工具》<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p></li> <li><p><a href="https://www.ibm.com/developerworks/cn/opensource/os-cn-elk/index.html" target="_blank" rel="noopener noreferrer">《集中式日志系统ELK》<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <ul><li>ElasticSearch：搜索引擎，实现全文检索。</li> <li>Logstash：负责从指定节点收集日志。</li> <li>Kibana：日志可视化工具。</li></ul></li> <li><p>大数据日志处理：Flume+Kafka日志采集、Storm / Spark实时数据处理、Impala实时查询。</p></li></ol> <h2 id="restful"><a href="#restful" class="header-anchor">#</a> RESTful</h2> <p>问题1：RESTful架构到底解决了什么问题？（URL具有自描述性、资源表述与视图的解耦和、互操作性利用构建微服务以及集成第三方系统、无状态性提高水平扩展能力）</p> <p>问题2：项目在使用RESTful架构时有没有遇到一些问题或隐患？（对资源访问的限制、资源从属关系检查、避免泄露业务信息、防范可能的攻击）</p> <blockquote><p>补充：下面的几个和安全性相关的响应头在前面讲中间件的时候提到过的。</p> <ul><li>X-Frame-Options: DENY</li> <li>X-Content-Type-Options: nosniff</li> <li>X-XSS-Protection: 1; mode=block;</li> <li>Strict­-Transport-­Security: max-age=31536000;</li></ul></blockquote> <p>问题3：如何保护API中的敏感信息以及防范重放攻击？（摘要和令牌）</p> <p>推荐阅读：<a href="https://help.aliyun.com/knowledge_detail/50041.html" target="_blank" rel="noopener noreferrer">《如何有效防止API的重放攻击》<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h4 id="使用djangorestframework"><a href="#使用djangorestframework" class="header-anchor">#</a> 使用djangorestframework</h4> <p>安装djangorestfrmework（为了描述方便，以下统一简称为DRF）。</p> <div class="language-Shell extra-class"><pre class="language-shell"><code>pip <span class="token function">install</span> djangorestframework
</code></pre></div><p>配置DRF。</p> <div class="language-Python extra-class"><pre class="language-python"><code>INSTALLED_APPS <span class="token operator">=</span> <span class="token punctuation">[</span>
    
    <span class="token string">'rest_framework'</span><span class="token punctuation">,</span>
    
<span class="token punctuation">]</span>

REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment"># 配置默认页面大小</span>
    <span class="token string">'PAGE_SIZE'</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
    <span class="token comment"># 配置默认的分页类</span>
    <span class="token string">'DEFAULT_PAGINATION_CLASS'</span><span class="token punctuation">:</span> <span class="token string">'rest_framework.pagination.PageNumberPagination'</span><span class="token punctuation">,</span>
    <span class="token comment"># 配置异常处理器</span>
    <span class="token comment"># 'EXCEPTION_HANDLER': 'api.exceptions.exception_handler',</span>
    <span class="token comment"># 配置默认解析器</span>
    <span class="token comment"># 'DEFAULT_PARSER_CLASSES': (</span>
    <span class="token comment">#     'rest_framework.parsers.JSONParser',</span>
    <span class="token comment">#     'rest_framework.parsers.FormParser',</span>
    <span class="token comment">#     'rest_framework.parsers.MultiPartParser',</span>
    <span class="token comment"># ),</span>
    <span class="token comment"># 配置默认限流类</span>
    <span class="token comment"># 'DEFAULT_THROTTLE_CLASSES': (),</span>
    <span class="token comment"># 配置默认授权类</span>
    <span class="token comment"># 'DEFAULT_PERMISSION_CLASSES': (</span>
    <span class="token comment">#     'rest_framework.permissions.IsAuthenticated',</span>
    <span class="token comment"># ),</span>
    <span class="token comment"># 配置默认认证类</span>
    <span class="token comment"># 'DEFAULT_AUTHENTICATION_CLASSES': (</span>
    <span class="token comment">#     'rest_framework_jwt.authentication.JSONWebTokenAuthentication',</span>
    <span class="token comment"># ),</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="编写序列化器"><a href="#编写序列化器" class="header-anchor">#</a> 编写序列化器</h3> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> serializers
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>serializers <span class="token keyword">import</span> ModelSerializer

<span class="token keyword">from</span> common<span class="token punctuation">.</span>models <span class="token keyword">import</span> District<span class="token punctuation">,</span> HouseType<span class="token punctuation">,</span> Estate<span class="token punctuation">,</span> Agent


<span class="token keyword">class</span> <span class="token class-name">DistrictSerializer</span><span class="token punctuation">(</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> District
        fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'distid'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">HouseTypeSerializer</span><span class="token punctuation">(</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> HouseType
        fields <span class="token operator">=</span> <span class="token string">'__all__'</span>


<span class="token keyword">class</span> <span class="token class-name">AgentSerializer</span><span class="token punctuation">(</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> Agent
        fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'agentid'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'tel'</span><span class="token punctuation">,</span> <span class="token string">'servstar'</span><span class="token punctuation">,</span> <span class="token string">'certificated'</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">EstateSerializer</span><span class="token punctuation">(</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    district <span class="token operator">=</span> serializers<span class="token punctuation">.</span>SerializerMethodField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    agents <span class="token operator">=</span> serializers<span class="token punctuation">.</span>SerializerMethodField<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token decorator annotation punctuation">@staticmethod</span>
    <span class="token keyword">def</span> <span class="token function">get_agents</span><span class="token punctuation">(</span>estate<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> AgentSerializer<span class="token punctuation">(</span>estate<span class="token punctuation">.</span>agents<span class="token punctuation">,</span> many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>data

    <span class="token decorator annotation punctuation">@staticmethod</span>
    <span class="token keyword">def</span> <span class="token function">get_district</span><span class="token punctuation">(</span>estate<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> DistrictSerializer<span class="token punctuation">(</span>estate<span class="token punctuation">.</span>district<span class="token punctuation">)</span><span class="token punctuation">.</span>data

    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> Estate
        fields <span class="token operator">=</span> <span class="token string">'__all__'</span>
</code></pre></div><h3 id="方法1-使用装饰器"><a href="#方法1-使用装饰器" class="header-anchor">#</a> 方法1：使用装饰器</h3> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token decorator annotation punctuation">@api_view</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@cache_page</span><span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> cache<span class="token operator">=</span><span class="token string">'api'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">provinces</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> District<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>parent__isnull<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    serializer <span class="token operator">=</span> DistrictSerializer<span class="token punctuation">(</span>queryset<span class="token punctuation">,</span> many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@api_view</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@cache_page</span><span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">,</span> cache<span class="token operator">=</span><span class="token string">'api'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">cities</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> provid<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> District<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>parent__distid<span class="token operator">=</span>provid<span class="token punctuation">)</span>
    serializer <span class="token operator">=</span> DistrictSerializer<span class="token punctuation">(</span>queryset<span class="token punctuation">,</span> many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
</code></pre></div><div class="language-Python extra-class"><pre class="language-python"><code>urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    path<span class="token punctuation">(</span><span class="token string">'districts/'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>provinces<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'districts'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    path<span class="token punctuation">(</span><span class="token string">'districts/&lt;int:provid&gt;/'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>cities<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'cities'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div><blockquote><p>说明：上面使用了Django自带的视图装饰器（@cache_page）来实现对API接口返回数据的缓存。</p></blockquote> <h3 id="方法2-使用apiview及其子类"><a href="#方法2-使用apiview及其子类" class="header-anchor">#</a> 方法2：使用APIView及其子类</h3> <p>更好的复用代码，不要重“复发明轮子”。</p> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">HouseTypeApiView</span><span class="token punctuation">(</span>CacheResponseMixin<span class="token punctuation">,</span> ListAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> HouseType<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> HouseTypeSerializer
</code></pre></div><div class="language-Python extra-class"><pre class="language-python"><code>urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    path<span class="token punctuation">(</span><span class="token string">'housetypes/'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>HouseTypeApiView<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'housetypes'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div><blockquote><p>说明：上面使用了drf_extensions提供的CacheResponseMixin混入类实现了对接口数据的缓存。如果重写了获取数据的方法，可以使用drf_extensions提供的@cache_response来实现对接口数据的缓存，也可以用自定义的函数来生成缓存中的key。当然还有一个选择就是通过Django提供的@method_decorator装饰器，将@cache_page装饰器处理为装饰方法的装饰器，这样也能提供使用缓存服务。</p></blockquote> <p><code>drf-extensions</code>配置如下所示。</p> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token comment"># 配置DRF扩展来支持缓存API接口调用结果</span>
REST_FRAMEWORK_EXTENSIONS <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'DEFAULT_CACHE_RESPONSE_TIMEOUT'</span><span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span>
    <span class="token string">'DEFAULT_USE_CACHE'</span><span class="token punctuation">:</span> <span class="token string">'default'</span><span class="token punctuation">,</span>
    <span class="token comment"># 配置默认缓存单个对象的key函数</span>
    <span class="token string">'DEFAULT_OBJECT_CACHE_KEY_FUNC'</span><span class="token punctuation">:</span> <span class="token string">'rest_framework_extensions.utils.default_object_cache_key_func'</span><span class="token punctuation">,</span>
    <span class="token comment"># 配置默认缓存对象列表的key函数</span>
    <span class="token string">'DEFAULT_LIST_CACHE_KEY_FUNC'</span><span class="token punctuation">:</span> <span class="token string">'rest_framework_extensions.utils.default_list_cache_key_func'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="方法3-使用viewset及其子类"><a href="#方法3-使用viewset及其子类" class="header-anchor">#</a> 方法3：使用ViewSet及其子类</h3> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">HouseTypeViewSet</span><span class="token punctuation">(</span>CacheResponseMixin<span class="token punctuation">,</span> viewsets<span class="token punctuation">.</span>ModelViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> HouseType<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> HouseTypeSerializer
    pagination_class <span class="token operator">=</span> <span class="token boolean">None</span>
</code></pre></div><div class="language-Python extra-class"><pre class="language-python"><code>router <span class="token operator">=</span> DefaultRouter<span class="token punctuation">(</span><span class="token punctuation">)</span>
router<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token string">'housetypes'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>HouseTypeViewSet<span class="token punctuation">)</span>

urlpatterns <span class="token operator">+=</span> router<span class="token punctuation">.</span>urls
</code></pre></div><p>djangorestframework提供了基于Bootstrap定制的页面来显示接口返回的JSON数据，当然也可以使用<a href="https://www.getpostman.com/" target="_blank" rel="noopener noreferrer">POSTMAN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>这样的工具对API接口进行测试。</p> <h4 id="补充说明"><a href="#补充说明" class="header-anchor">#</a> 补充说明</h4> <p>在这里顺便提一下跟前端相关的几个问题。</p> <p>问题1：如何让浏览器能够发起DELETE/PUT/PATCH？</p> <div class="language-HTML extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>_method<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>delete<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-Python extra-class"><pre class="language-python"><code><span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span> <span class="token keyword">and</span> <span class="token string">'_method'</span> <span class="token keyword">in</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">:</span>
    request<span class="token punctuation">.</span>method <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">[</span><span class="token string">'_method'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-HTML extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token string">'url'</span><span class="token operator">:</span> <span class="token string">'/api/provinces'</span><span class="token punctuation">,</span>
        <span class="token string">'type'</span><span class="token operator">:</span> <span class="token string">'put'</span><span class="token punctuation">,</span>
        <span class="token string">'data'</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">'dataType'</span><span class="token operator">:</span> <span class="token string">'json'</span><span class="token punctuation">,</span>
        <span class="token string">'success'</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">json</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Web = 标签(内容) + CSS(显示) + JS(行为)</span>
            <span class="token comment">// 01.JavaScript = ES + BOM + DOM</span>
            <span class="token comment">// DOM操作实现页面的局部刷新</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">'error'</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    $<span class="token punctuation">.</span><span class="token function">getJSON</span><span class="token punctuation">(</span><span class="token string">'/api/provinces'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">json</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// DOM操作实现页面的局部刷新</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>问题2：如何解决多个JavaScript库之间某个定义（如$函数）冲突的问题？</p> <div class="language-HTML extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>js/jquery.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>js/abc.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token comment">// $已经被后加载的JavaScript库占用了</span>
    <span class="token comment">// 但是可以直接用绑定在window对象上的jQuery去代替$</span>
    <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">'#okBtn'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-HTML extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>js/abc.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>js/jquery.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token comment">// 将$让出给其他的JavaScript库使用</span>
	jQuery<span class="token punctuation">.</span><span class="token function">noConflict</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">'#okBtn'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>问题3：jQuery对象与原生DOM对象之间如何转换？</p> <div class="language-HTML extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>okBtn<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>点我<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>js/jquery.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">var</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'okBtn'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 原生JavaScript对象(使用相对麻烦)</span>
    <span class="token keyword">var</span> $btn <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#okBtn'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// jQuery对象(拥有更多的属性和方法而且没有浏览器兼容性问题)</span>
    $btn<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// $(btn)可以将原生JavaScript对象转成jQuery对象</span>
    <span class="token comment">// $btn.get(0)或$btn[0]可以获得原生的JavaScript对象</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="过滤数据"><a href="#过滤数据" class="header-anchor">#</a> 过滤数据</h3> <p>如果需要过滤数据（对数据接口设置筛选条件、排序条件等），可以使用<code>django-filter</code>三方库来实现。</p> <div class="language-Shell extra-class"><pre class="language-shell"><code>pip <span class="token function">install</span> django-filter
</code></pre></div><div class="language-Python extra-class"><pre class="language-python"><code>INSTALLED_APPS <span class="token operator">=</span> <span class="token punctuation">[</span>
    
    <span class="token string">'django_filters'</span><span class="token punctuation">,</span>

<span class="token punctuation">]</span>
REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{</span>
  	
    <span class="token string">'DEFAULT_FILTER_BACKENDS'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>
        <span class="token string">'django_filters.rest_framework.DjangoFilterBackend'</span><span class="token punctuation">,</span>
        <span class="token string">'rest_framework.filters.OrderingFilter'</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    
<span class="token punctuation">}</span>
</code></pre></div><div class="language-Python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>decorators <span class="token keyword">import</span> method_decorator
<span class="token keyword">from</span> django<span class="token punctuation">.</span>views<span class="token punctuation">.</span>decorators<span class="token punctuation">.</span>cache <span class="token keyword">import</span> cache_page
<span class="token keyword">from</span> django_filters<span class="token punctuation">.</span>rest_framework <span class="token keyword">import</span> DjangoFilterBackend
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>filters <span class="token keyword">import</span> OrderingFilter
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>generics <span class="token keyword">import</span> RetrieveAPIView<span class="token punctuation">,</span> ListCreateAPIView

<span class="token keyword">from</span> api<span class="token punctuation">.</span>serializers <span class="token keyword">import</span> EstateSerializer
<span class="token keyword">from</span> common<span class="token punctuation">.</span>models <span class="token keyword">import</span> Estate


<span class="token decorator annotation punctuation">@method_decorator</span><span class="token punctuation">(</span>decorator<span class="token operator">=</span>cache_page<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">120</span><span class="token punctuation">,</span> cache<span class="token operator">=</span><span class="token string">'api'</span><span class="token punctuation">,</span> key_prefix<span class="token operator">=</span><span class="token string">'estates'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'get'</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">EstateView</span><span class="token punctuation">(</span>RetrieveAPIView<span class="token punctuation">,</span> ListCreateAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> Estate<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>select_related<span class="token punctuation">(</span><span class="token string">'district'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>prefetch_related<span class="token punctuation">(</span><span class="token string">'agents'</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> EstateSerializer
    filter_backends <span class="token operator">=</span> <span class="token punctuation">(</span>DjangoFilterBackend<span class="token punctuation">,</span> OrderingFilter<span class="token punctuation">)</span>
    filter_fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'district'</span><span class="token punctuation">)</span>
    ordering <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'-hot'</span><span class="token punctuation">,</span> <span class="token punctuation">)</span>
    ordering_fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'hot'</span><span class="token punctuation">,</span> <span class="token string">'estateid'</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-Python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django_filters <span class="token keyword">import</span> rest_framework <span class="token keyword">as</span> drf
<span class="token keyword">from</span> common<span class="token punctuation">.</span>models <span class="token keyword">import</span> HouseInfo


<span class="token keyword">class</span> <span class="token class-name">HouseInfoFilter</span><span class="token punctuation">(</span>drf<span class="token punctuation">.</span>FilterSet<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;自定义房源数据过滤器&quot;&quot;&quot;</span>

    title <span class="token operator">=</span> drf<span class="token punctuation">.</span>CharFilter<span class="token punctuation">(</span>lookup_expr<span class="token operator">=</span><span class="token string">'starts'</span><span class="token punctuation">)</span>
    dist <span class="token operator">=</span> drf<span class="token punctuation">.</span>NumberFilter<span class="token punctuation">(</span>field_name<span class="token operator">=</span><span class="token string">'district'</span><span class="token punctuation">)</span>
    min_price <span class="token operator">=</span> drf<span class="token punctuation">.</span>NumberFilter<span class="token punctuation">(</span>field_name<span class="token operator">=</span><span class="token string">'price'</span><span class="token punctuation">,</span> lookup_expr<span class="token operator">=</span><span class="token string">'gte'</span><span class="token punctuation">)</span>
    max_price <span class="token operator">=</span> drf<span class="token punctuation">.</span>NumberFilter<span class="token punctuation">(</span>field_name<span class="token operator">=</span><span class="token string">'price'</span><span class="token punctuation">,</span> lookup_expr<span class="token operator">=</span><span class="token string">'lte'</span><span class="token punctuation">)</span>
    <span class="token builtin">type</span> <span class="token operator">=</span> drf<span class="token punctuation">.</span>NumberFilter<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> HouseInfo
        fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'district'</span><span class="token punctuation">,</span> <span class="token string">'min_price'</span><span class="token punctuation">,</span> <span class="token string">'max_price'</span><span class="token punctuation">,</span> <span class="token string">'type'</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-Python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">HouseInfoViewSet</span><span class="token punctuation">(</span>CacheResponseMixin<span class="token punctuation">,</span> ReadOnlyModelViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> HouseInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span> \
        <span class="token punctuation">.</span>select_related<span class="token punctuation">(</span><span class="token string">'type'</span><span class="token punctuation">,</span> <span class="token string">'district'</span><span class="token punctuation">,</span> <span class="token string">'estate'</span><span class="token punctuation">,</span> <span class="token string">'agent'</span><span class="token punctuation">)</span> \
        <span class="token punctuation">.</span>prefetch_related<span class="token punctuation">(</span><span class="token string">'tags'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>order_by<span class="token punctuation">(</span><span class="token string">'-pubdate'</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> HouseInfoSerializer
    filter_backends <span class="token operator">=</span> <span class="token punctuation">(</span>DjangoFilterBackend<span class="token punctuation">,</span> OrderingFilter<span class="token punctuation">)</span>
    filterset_class <span class="token operator">=</span> HouseInfoFilter
    ordering <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'price'</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
    ordering_fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'price'</span><span class="token punctuation">,</span> <span class="token string">'area'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="身份认证"><a href="#身份认证" class="header-anchor">#</a> 身份认证</h3> <p>查看DRF中APIView类的代码可以看出，DRF默认的认证方案是 <code>DEFAULT_AUTHENTICATION_CLASSES</code>，如果修改authentication_classes就可以自行定制身份认证的方案。</p> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">APIView</span><span class="token punctuation">(</span>View<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token comment"># The following policies may be set at either globally, or per-view.</span>
    renderer_classes <span class="token operator">=</span> api_settings<span class="token punctuation">.</span>DEFAULT_RENDERER_CLASSES
    parser_classes <span class="token operator">=</span> api_settings<span class="token punctuation">.</span>DEFAULT_PARSER_CLASSES
    authentication_classes <span class="token operator">=</span> api_settings<span class="token punctuation">.</span>DEFAULT_AUTHENTICATION_CLASSES
    throttle_classes <span class="token operator">=</span> api_settings<span class="token punctuation">.</span>DEFAULT_THROTTLE_CLASSES
    permission_classes <span class="token operator">=</span> api_settings<span class="token punctuation">.</span>DEFAULT_PERMISSION_CLASSES
    content_negotiation_class <span class="token operator">=</span> api_settings<span class="token punctuation">.</span>DEFAULT_CONTENT_NEGOTIATION_CLASS
    metadata_class <span class="token operator">=</span> api_settings<span class="token punctuation">.</span>DEFAULT_METADATA_CLASS
    versioning_class <span class="token operator">=</span> api_settings<span class="token punctuation">.</span>DEFAULT_VERSIONING_CLASS

   	<span class="token comment"># 此处省略下面的代码</span>
</code></pre></div><div class="language-Python extra-class"><pre class="language-python"><code>DEFAULTS <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment"># Base API policies</span>
    <span class="token string">'DEFAULT_RENDERER_CLASSES'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>
        <span class="token string">'rest_framework.renderers.JSONRenderer'</span><span class="token punctuation">,</span>
        <span class="token string">'rest_framework.renderers.BrowsableAPIRenderer'</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">'DEFAULT_PARSER_CLASSES'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>
        <span class="token string">'rest_framework.parsers.JSONParser'</span><span class="token punctuation">,</span>
        <span class="token string">'rest_framework.parsers.FormParser'</span><span class="token punctuation">,</span>
        <span class="token string">'rest_framework.parsers.MultiPartParser'</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">'DEFAULT_AUTHENTICATION_CLASSES'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>
        <span class="token string">'rest_framework.authentication.SessionAuthentication'</span><span class="token punctuation">,</span>
        <span class="token string">'rest_framework.authentication.BasicAuthentication'</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">'DEFAULT_PERMISSION_CLASSES'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>
        <span class="token string">'rest_framework.permissions.AllowAny'</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">'DEFAULT_THROTTLE_CLASSES'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">'DEFAULT_CONTENT_NEGOTIATION_CLASS'</span><span class="token punctuation">:</span> <span class="token string">'rest_framework.negotiation.DefaultContentNegotiation'</span><span class="token punctuation">,</span>
    <span class="token string">'DEFAULT_METADATA_CLASS'</span><span class="token punctuation">:</span> <span class="token string">'rest_framework.metadata.SimpleMetadata'</span><span class="token punctuation">,</span>
    <span class="token string">'DEFAULT_VERSIONING_CLASS'</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>

    <span class="token comment"># 此处省略下面的代码</span>
<span class="token punctuation">}</span>
</code></pre></div><p>自定义认证类，继承<code>BaseAuthentication</code>并重写<code>authenticate(self, request)</code>方法，通过请求中的userid和token来确定用户身份。如果认证成功，该方法应返回一个二元组（用户和令牌的信息），否则产生异常。也可以重写 <code>authenticate_header(self, request)</code>方法来返回一个字符串，该字符串将用于<code>HTTP 401 Unauthorized</code>响应中的WWW-Authenticate响应头的值。如果未重写该方法，那么当未经身份验证的请求被拒绝访问时，身份验证方案将返回<code>HTTP 403 Forbidden</code>响应。</p> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">MyAuthentication</span><span class="token punctuation">(</span>BaseAuthentication<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;自定义用户身份认证类&quot;&quot;&quot;</span>

    <span class="token keyword">def</span> <span class="token function">authenticate</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            token <span class="token operator">=</span> request<span class="token punctuation">.</span>GET<span class="token punctuation">[</span><span class="token string">'token'</span><span class="token punctuation">]</span> <span class="token keyword">or</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">[</span><span class="token string">'token'</span><span class="token punctuation">]</span>
            user_token <span class="token operator">=</span> UserToken<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>token<span class="token operator">=</span>token<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> user_token<span class="token punctuation">:</span>
                <span class="token keyword">return</span> user_token<span class="token punctuation">.</span>user<span class="token punctuation">,</span> user_token
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">raise</span> AuthenticationFailed<span class="token punctuation">(</span><span class="token string">'请提供有效的用户身份标识'</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> KeyError<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> AuthenticationFailed<span class="token punctuation">(</span><span class="token string">'请提供有效的用户身份标识'</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">authenticate_header</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
</code></pre></div><p>使用自定义的认证类。</p> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">EstateViewSet</span><span class="token punctuation">(</span>CacheResponseMixin<span class="token punctuation">,</span> ModelViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 通过queryset指定如何获取数据（资源）</span>
    queryset <span class="token operator">=</span> Estate<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>select_related<span class="token punctuation">(</span><span class="token string">'district'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>prefetch_related<span class="token punctuation">(</span><span class="token string">'agents'</span><span class="token punctuation">)</span>
    <span class="token comment"># 通过serializer_class指定如何序列化数据</span>
    serializer_class <span class="token operator">=</span> EstateSerializer
    <span class="token comment"># 指定根据哪些字段进行数据筛选</span>
    filter_fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'district'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">)</span>
    <span class="token comment"># 指定根据哪些字段对数据进行排序</span>
    ordering_fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'hot'</span><span class="token punctuation">,</span> <span class="token punctuation">)</span>
    <span class="token comment"># 指定用于进行用户身份验证的类</span>
    authentication_classes <span class="token operator">=</span> <span class="token punctuation">(</span>MyAuthentication<span class="token punctuation">,</span> <span class="token punctuation">)</span>
</code></pre></div><blockquote><p>说明：也可以在Django配置文件中将自定义的认证类设置为默认认证方式。</p></blockquote> <h3 id="授予权限"><a href="#授予权限" class="header-anchor">#</a> 授予权限</h3> <p>权限检查总是在视图的最开始处运行，在任何其他代码被允许进行之前。最简单的权限是允许通过身份验证的用户访问，并拒绝未经身份验证的用户访问，这对应于dfr中的<code>IsAuthenticated</code>类，可以用它来取代默认的<code>AllowAny</code>类。权限策略可以在Django的DRF配置中用<code>DEFAULT_PERMISSION_CLASSES</code>全局设置。</p> <div class="language-Python extra-class"><pre class="language-python"><code>REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'DEFAULT_PERMISSION_CLASSES'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>
        <span class="token string">'rest_framework.permissions.IsAuthenticated'</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>也可以在基于<code>APIView</code>类的视图上设置身份验证策略。</p> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>permissions <span class="token keyword">import</span> IsAuthenticated
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>views <span class="token keyword">import</span> APIView

<span class="token keyword">class</span> <span class="token class-name">ExampleView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    permission_classes <span class="token operator">=</span> <span class="token punctuation">(</span>IsAuthenticated<span class="token punctuation">,</span> <span class="token punctuation">)</span>
    <span class="token comment"># 此处省略其他代码</span>
</code></pre></div><p>或者在基于<code>@api_view</code>装饰器的视图函数上设置。</p> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>decorators <span class="token keyword">import</span> api_view<span class="token punctuation">,</span> permission_classes
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>permissions <span class="token keyword">import</span> IsAuthenticated

<span class="token decorator annotation punctuation">@api_view</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@permission_classes</span><span class="token punctuation">(</span><span class="token punctuation">(</span>IsAuthenticated<span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">example_view</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 此处省略其他代码</span>
</code></pre></div><p>自定义权限需要继承<code>BasePermission</code>并实现以下方法中的一个或两个，下面是BasePermission的代码。</p> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token decorator annotation punctuation">@six<span class="token punctuation">.</span>add_metaclass</span><span class="token punctuation">(</span>BasePermissionMetaclass<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">BasePermission</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    A base class from which all permission classes should inherit.
    &quot;&quot;&quot;</span>

    <span class="token keyword">def</span> <span class="token function">has_permission</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> view<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Return `True` if permission is granted, `False` otherwise.
        &quot;&quot;&quot;</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span>

    <span class="token keyword">def</span> <span class="token function">has_object_permission</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> view<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Return `True` if permission is granted, `False` otherwise.
        &quot;&quot;&quot;</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span>
</code></pre></div><p>如果请求被授予访问权限，则方法应该返回True，否则返False。下面的例子演示了阻止黑名单中的IP地址访问接口数据（这个在反爬虫的时候很有用哟）。</p> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> permissions


<span class="token keyword">class</span> <span class="token class-name">BlacklistPermission</span><span class="token punctuation">(</span>permissions<span class="token punctuation">.</span>BasePermission<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    Global permission check for blacklisted IPs.
    &quot;&quot;&quot;</span>

    <span class="token keyword">def</span> <span class="token function">has_permission</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> view<span class="token punctuation">)</span><span class="token punctuation">:</span>
        ip_addr <span class="token operator">=</span> request<span class="token punctuation">.</span>META<span class="token punctuation">[</span><span class="token string">'REMOTE_ADDR'</span><span class="token punctuation">]</span>
        blacklisted <span class="token operator">=</span> Blacklist<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>ip_addr<span class="token operator">=</span>ip_addr<span class="token punctuation">)</span><span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token keyword">not</span> blacklisted
</code></pre></div><p>如果要实现更为完整的权限验证，可以考虑RBAC或ACL。</p> <ol><li><p>RBAC - 基于角色的访问控制，如下图所示。</p> <p><img src="https://cdn.jsdelivr.net/gh/wuKongNotNull/images-hosting/wukong-website/rbac-basic.png" alt=""></p></li> <li><p>ACL - 访问控制列表（每个用户绑定自己的访问白名单或黑名单）。</p></li></ol> <h3 id="访问限流"><a href="#访问限流" class="header-anchor">#</a> 访问限流</h3> <p>可以修改dfr配置的<code>DEFAULT_THROTTLE_CLASSES</code> 和 <code>DEFAULT_THROTTLE_RATES</code>两个值来设置全局默认限流策略。例如：</p> <div class="language-Python extra-class"><pre class="language-python"><code>REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'DEFAULT_THROTTLE_CLASSES'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>
        <span class="token string">'rest_framework.throttling.AnonRateThrottle'</span><span class="token punctuation">,</span>
        <span class="token string">'rest_framework.throttling.UserRateThrottle'</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">'DEFAULT_THROTTLE_RATES'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">'anon'</span><span class="token punctuation">:</span> <span class="token string">'3/min'</span><span class="token punctuation">,</span>
        <span class="token string">'user'</span><span class="token punctuation">:</span> <span class="token string">'10000/day'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>DEFAULT_THROTTLE_RATES</code>中使用的频率描述可能包括<code>second</code>、<code>minute</code>、<code>hour</code>或<code>day</code>。</p> <p>如果要为接口单独设置限流，可以在每个视图或视图集上设置限流策略，如下所示：</p> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>throttling <span class="token keyword">import</span> UserRateThrottle
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>views <span class="token keyword">import</span> APIView


<span class="token keyword">class</span> <span class="token class-name">ExampleView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    throttle_classes <span class="token operator">=</span> <span class="token punctuation">(</span>UserRateThrottle<span class="token punctuation">,</span> <span class="token punctuation">)</span>
    <span class="token comment"># 此处省略下面的代码</span>
</code></pre></div><p>或</p> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token decorator annotation punctuation">@api_view</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@throttle_classes</span><span class="token punctuation">(</span><span class="token punctuation">[</span>UserRateThrottle<span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">example_view</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 此处省略下面的代码</span>
</code></pre></div><p>当然也可以通过继承<code>SimpleRateThrottle</code>来自定义限流策略，通常需要重写<code>allow_request</code>和<code>wait</code>方法。</p> <h2 id="异步任务和计划任务"><a href="#异步任务和计划任务" class="header-anchor">#</a> 异步任务和计划任务</h2> <h3 id="celery的应用"><a href="#celery的应用" class="header-anchor">#</a> Celery的应用</h3> <p>Celery 是一个简单、灵活且可靠的，处理大量消息的分布式系统，并且提供维护这样一个系统的必需工具。它是一个专注于实时处理的任务队列，同时也支持任务调度。</p> <p>推荐阅读：<a href="http://docs.jinkan.org/docs/celery/" target="_blank" rel="noopener noreferrer">《Celery官方文档中文版》<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，上面有极为详细的配置和使用指南。</p> <p><img src="https://cdn.jsdelivr.net/gh/wuKongNotNull/images-hosting/wukong-website/celery_architecture.png" alt=""></p> <p>Celery是一个本身不提供队列服务，官方推荐使用RabbitMQ或Redis来实现消息队列服务，前者是更好的选择，它对AMQP（高级消息队列协议）做出了非常好的实现。</p> <ol><li><p>安装RabbitMQ。</p> <div class="language-Shell extra-class"><pre class="language-shell"><code>docker pull rabbitmq
docker run -d -p <span class="token number">5672</span>:5672 --name myrabbit rabbitmq
docker container <span class="token builtin class-name">exec</span> -it myrabbit /bin/bash
</code></pre></div></li> <li><p>创建用户、资源以及分配操作权限。</p> <div class="language-Shell extra-class"><pre class="language-shell"><code>rabbitmqctl add_user luohao <span class="token number">123456</span>
rabbitmqctl set_user_tags luohao administrator
rabbitmqctl add_vhost vhost1
rabbitmqctl set_permissions -p vhost1 luohao <span class="token string">&quot;.*&quot;</span> <span class="token string">&quot;.*&quot;</span> <span class="token string">&quot;.*&quot;</span>
</code></pre></div></li> <li><p>创建Celery实例。</p> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token comment"># 注册环境变量</span>
os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">'DJANGO_SETTINGS_MODULE'</span><span class="token punctuation">,</span> <span class="token string">'项目名.settings'</span><span class="token punctuation">)</span>

<span class="token comment"># 创建Celery实例</span>
app <span class="token operator">=</span> celery<span class="token punctuation">.</span>Celery<span class="token punctuation">(</span>
    <span class="token string">'fangtx'</span><span class="token punctuation">,</span>
    broker<span class="token operator">=</span><span class="token string">'amqp://luohao:123456@1.2.3.4:5672/vhost1'</span>
<span class="token punctuation">)</span>

<span class="token comment"># 从项目的配置文件读取Celery配置信息</span>
<span class="token comment"># app.config_from_object('django.conf:settings')</span>
<span class="token comment"># 从指定的文件(例如celery_config.py)中读取Celery配置信息</span>
<span class="token comment"># app.config_from_object('celery_config')</span>

<span class="token comment"># 让Celery自动从参数指定的应用中发现异步任务/定时任务</span>
<span class="token comment"># app.autodiscover_tasks(['common', ])</span>
<span class="token comment"># 让Celery自动从所有注册的应用中发现异步任务/定时任务</span>
app<span class="token punctuation">.</span>autodiscover_tasks<span class="token punctuation">(</span><span class="token keyword">lambda</span><span class="token punctuation">:</span> settings<span class="token punctuation">.</span>INSTALLED_APPS<span class="token punctuation">)</span>
</code></pre></div></li> <li><p>启动Celery创建woker（消息的消费者）。</p> <div class="language-Shell extra-class"><pre class="language-shell"><code>celery -A <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span> worker -l debug <span class="token operator">&amp;</span>
</code></pre></div></li> <li><p>执行异步任务。</p> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>task</span>
<span class="token keyword">def</span> <span class="token function">send_email</span><span class="token punctuation">(</span>from_user<span class="token punctuation">,</span> to_user<span class="token punctuation">,</span> cc_user<span class="token punctuation">,</span> subject<span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>


<span class="token comment"># 消息的生产者</span>
send_email<span class="token punctuation">.</span>delay<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>创建定时任务。</p> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token comment"># 配置定时任务（计划任务）</span>
app<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>update<span class="token punctuation">(</span>
    timezone<span class="token operator">=</span>settings<span class="token punctuation">.</span>TIME_ZONE<span class="token punctuation">,</span>
    enable_utc<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    <span class="token comment"># 定时任务（计划任务）相当于是消息的生产者</span>
    <span class="token comment"># 如果只有生产者没有消费者那么消息就会在消息队列中积压</span>
    <span class="token comment"># 将来实际部署项目的时候生产者、消费者、消息队列可能都是不同节点</span>
    beat_schedule<span class="token operator">=</span><span class="token punctuation">{</span>
        <span class="token string">'task1'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">'task'</span><span class="token punctuation">:</span> <span class="token string">'common.tasks.scheduled_task'</span><span class="token punctuation">,</span>
            <span class="token string">'schedule'</span><span class="token punctuation">:</span> crontab<span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">'args'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token string">'...'</span><span class="token punctuation">,</span> <span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
</code></pre></div><div class="language-Python extra-class"><pre class="language-python"><code><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>task</span>
<span class="token keyword">def</span> <span class="token function">scheduled_task</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
</code></pre></div></li> <li><p>启动Celery创建执行定时任务的beat（消息的生产者）。</p> <div class="language-Shell extra-class"><pre class="language-shell"><code>celery -A <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span> beat -l info
</code></pre></div></li> <li><p>检查消息队列状况。</p> <div class="language-Shell extra-class"><pre class="language-shell"><code>rabbitmqctl list_queues -p vhost1
</code></pre></div></li> <li><p>监控Celery - 可以通过flower来对Celery进行监控。</p> <div class="language-Shell extra-class"><pre class="language-shell"><code>pip <span class="token function">install</span> flower
celery flower --broker<span class="token operator">=</span>amqp://luohao:123456@120.77.222.217:5672/vhost1
</code></pre></div></li></ol> <h2 id="其他问题"><a href="#其他问题" class="header-anchor">#</a> 其他问题</h2> <p>问题1：如何解决JavaScript跨域获取数据的问题？（django-cors-headers）</p> <div class="language-Python extra-class"><pre class="language-python"><code>INSTALLED_APPS <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'corsheaders'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

MIDDLEWARE <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'corsheaders.middleware.CorsMiddleware'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

CORS_ORIGIN_ALLOW_ALL <span class="token operator">=</span> <span class="token boolean">True</span>
<span class="token comment"># 配置跨域白名单</span>
<span class="token comment"># CORS_ORIGIN_WHITELIST = ('www.abc.com', 'www.baidu.com')</span>
<span class="token comment"># CORS_ORIGIN_REGEX_WHITELIST = ('...', )</span>
<span class="token comment"># CORS_ALLOW_CREDENTIALS = True</span>
<span class="token comment"># CORS_ALLOW_METHODS = ('GET', 'POST', 'PUT', 'DELETE')</span>
</code></pre></div><p>问题2：网站图片（水印、剪裁）和视频（截图、水印、转码）是如何处理的？（云存储、FFmpeg）</p> <p>问题3：网站如何架设（静态资源）文件系统？（FastDFS、云存储、CDN）</p> <h2 id="安全保护"><a href="#安全保护" class="header-anchor">#</a> 安全保护</h2> <p>问题1：什么是跨站脚本攻击（XSS)，如何防范？（对提交的内容进行消毒）</p> <p>问题2：什么是跨站身份伪造（CSRF），如何防范？（使用随机令牌）</p> <p>问题3：什么是SQL注射攻击（SQL Injection），如何防范？（不拼接SQL语句，避免使用单引号）</p> <p>问题4：什么是点击劫持攻击（Click-hacking），如何防范？（不允许<code>&lt;iframe&gt;</code>加载非同源站点内容）</p> <h3 id="django提供的安全措施"><a href="#django提供的安全措施" class="header-anchor">#</a> Django提供的安全措施</h3> <p>签名数据的API</p> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>signing <span class="token keyword">import</span> Signer
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> signer <span class="token operator">=</span> Signer<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> value <span class="token operator">=</span> signer<span class="token punctuation">.</span>sign<span class="token punctuation">(</span><span class="token string">'hello, world!'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> value
<span class="token string">'hello, world!:BYMlgvWMTSPLxC-DqxByleiMVXU'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> signer<span class="token punctuation">.</span>unsign<span class="token punctuation">(</span>value<span class="token punctuation">)</span>
<span class="token string">'hello, world!'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> signer <span class="token operator">=</span> Signer<span class="token punctuation">(</span>salt<span class="token operator">=</span><span class="token string">'yoursalt'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> signer<span class="token punctuation">.</span>sign<span class="token punctuation">(</span><span class="token string">'hello, world!'</span><span class="token punctuation">)</span>
<span class="token string">'hello, world!:9vEvG6EA05hjMDB5MtUr33nRA_M'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>signing <span class="token keyword">import</span> TimestampSigner
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> signer <span class="token operator">=</span> TimestampSigner<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> value <span class="token operator">=</span> signer<span class="token punctuation">.</span>sign<span class="token punctuation">(</span><span class="token string">'hello, world!'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> value
<span class="token string">'hello, world!:1fpmcQ:STwj464IFE6eUB-_-hyUVF3d2So'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> signer<span class="token punctuation">.</span>unsign<span class="token punctuation">(</span>value<span class="token punctuation">,</span> max_age<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
 File <span class="token string">&quot;&lt;console&gt;&quot;</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">&gt;</span>
 File <span class="token string">&quot;/Users/Hao/Desktop/fang.com/venv/lib/python3.6/site-packages/django/core/signing.py&quot;</span><span class="token punctuation">,</span> line <span class="token number">198</span><span class="token punctuation">,</span> <span class="token keyword">in</span> unsign
 <span class="token string">'Signature age %s &gt; %s seconds'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>age<span class="token punctuation">,</span> max_age<span class="token punctuation">)</span><span class="token punctuation">)</span>
 django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>signing<span class="token punctuation">.</span>SignatureExpired<span class="token punctuation">:</span> Signature age <span class="token number">21.020604848861694</span> <span class="token operator">&gt;</span> <span class="token number">5</span> seconds
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> signer<span class="token punctuation">.</span>unsign<span class="token punctuation">(</span>value<span class="token punctuation">,</span> max_age<span class="token operator">=</span><span class="token number">120</span><span class="token punctuation">)</span>
<span class="token string">'hello, world!'</span>
</code></pre></div><p>CSRF令牌和小工具</p> <div class="language-HTML extra-class"><pre class="language-html"><code>{% csrf_token %}
</code></pre></div><ul><li>@csrf_exempt：免除令牌</li> <li>@csrf_protect：提供令牌保护</li> <li>@require_csrf_token：提供令牌保护</li> <li>@ensure_csrf_cookie：强制视图发送带令牌的cookie</li></ul> <blockquote><p>说明：可以在Chrome浏览器中安装EditThisCookie插件来方便的查看Cookie。</p></blockquote> <h3 id="用户敏感信息的保护"><a href="#用户敏感信息的保护" class="header-anchor">#</a> 用户敏感信息的保护</h3> <ol><li><p>哈希摘要（签名）</p> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">import</span> hashlib
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> md5_hasher <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> md5_hasher<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">'hello, world!'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> md5_hasher<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token string">'3adbbad1791fbae3ec908894c4963870'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> sha1_hasher <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>sha1<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> sha1_hasher<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">'hello, world!'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> sha1_hasher<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">'goodbye, world!'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> sha1_hasher<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token string">'1f09d30c707d53f3d16c530dd73d70a6ce7596a9'</span>
</code></pre></div></li> <li><p>加密和解密（对称加密和非对称加密）</p> <div class="language-Shell extra-class"><pre class="language-shell"><code>pip <span class="token function">install</span> pycrypto
</code></pre></div><p>AES对称加密：</p> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> hashlib <span class="token keyword">import</span> md5
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Cipher <span class="token keyword">import</span> AES
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> Crypto <span class="token keyword">import</span> Random
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> key <span class="token operator">=</span> md5<span class="token punctuation">(</span><span class="token string">b'mysecret'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> iv <span class="token operator">=</span> Random<span class="token punctuation">.</span>new<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span>AES<span class="token punctuation">.</span>block_size<span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> str1 <span class="token operator">=</span> <span class="token string">'我爱你们！'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> str2 <span class="token operator">=</span> AES<span class="token punctuation">.</span>new<span class="token punctuation">(</span>key<span class="token punctuation">,</span> AES<span class="token punctuation">.</span>MODE_CFB<span class="token punctuation">,</span> iv<span class="token punctuation">)</span><span class="token punctuation">.</span>encrypt<span class="token punctuation">(</span>str1<span class="token punctuation">)</span>
<span class="token string">b'p\x96o\x85\x0bq\xc4-Y\xc4\xbcp\n)&amp;'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> str3 <span class="token operator">=</span> AES<span class="token punctuation">.</span>new<span class="token punctuation">(</span>key<span class="token punctuation">,</span> AES<span class="token punctuation">.</span>MODE_CFB<span class="token punctuation">,</span> iv<span class="token punctuation">)</span><span class="token punctuation">.</span>decrypt<span class="token punctuation">(</span>str2<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token string">'我爱你们！'</span>
</code></pre></div><p>RSA非对称加密：</p> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>PublicKey <span class="token keyword">import</span> RSA
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token comment"># 生成密钥对</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> key_pair <span class="token operator">=</span> RSA<span class="token punctuation">.</span>generate<span class="token punctuation">(</span><span class="token number">2048</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token comment"># 导入公钥</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> pub_key <span class="token operator">=</span> RSA<span class="token punctuation">.</span>importKey<span class="token punctuation">(</span>key_pair<span class="token punctuation">.</span>publickey<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>exportKey<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token comment"># 导入私钥</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> pri_key <span class="token operator">=</span> RSA<span class="token punctuation">.</span>importKey<span class="token punctuation">(</span>key_pair<span class="token punctuation">.</span>exportKey<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token comment"># 明文</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> message1 <span class="token operator">=</span> <span class="token string">'hello, world!'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token comment"># 加密数据</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> message2 <span class="token operator">=</span> pub_key<span class="token punctuation">.</span>encrypt<span class="token punctuation">(</span>message1<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token string">b'\x03\x86t\xa0\x00\xc4\xea\xd2\x80\xed\xa7YN7\x07\xff\x88\xaa\x1eW\x0cmH0\x06\xa7\'\xbc&lt;w@q\x8b\xaf\xf7:g\x92{=\xe2E\xa5@\x1as2\xdd\xcb\x8e[\x98\x85\xdf,X\xecj.U\xd6\xa7W&amp;u\'Uz&quot;\x0f\x0e\\&lt;\xa4\xfavC\x93\xa7\xbcO&quot;\xb9a\x06]&lt;.\xc1\r1}*\xdf\xccdqXML\x93\x1b\xe9\xda\xdf\xab|\xf8\x18\xe4\x99\xbb\x7f\x18}\xd9\x9a\x1e*J\\\xca\x1a\xd1\x85\xf7t\x81\xd95{\x19\xc9\x81\xb6^}\x9c5\xca\xfe\xcf\xc8\xd8M\x9a\x8c-\xf1t\xee\xf9\x12\x90\x01\xca\x92~\x00c5qg5g\x95&amp;\x10\xb1\x0b\x1fo\x95\xf2\xbc\x8d\xf3f&quot;@\xc5\x188\x0bX\x9cfo\xea\x97\x05@\xe5\xb2\xda\xb8\x97a\xa5w\xa8\x01\x9a\xa5N\xc4\x81\x8d\x0f&lt;\x96iU\xd3\x95\xacJZs\xab_ #\xee\xf9\x0f\xf2\x12\xdb\xfc\xf8g\x18v\x02k+\xda\x16Si\xbf\xbb\xec\xf7w\x90\xde\xae\x97\t\xed{}5\xd0'</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token comment"># 解密数据</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> message3 <span class="token operator">=</span> pri_key<span class="token punctuation">.</span>decrypt<span class="token punctuation">(</span>message2<span class="token punctuation">)</span>
<span class="token string">'hello, world!'</span>
</code></pre></div></li></ol> <h3 id="安全相关建议"><a href="#安全相关建议" class="header-anchor">#</a> 安全相关建议</h3> <ol><li>虽然 Django 自带了稳固的安全保护措施，但是依然要采用正确的方式部署应用程序，利用 Web 服务器、操作系统和其他组件提供的安全保护措施。</li> <li>记得把 Python 代码放在 Web 服务器的文档根目录之外，避免代码意外泄露。</li> <li>谨慎处理用户上传的文件。</li> <li>Django本身没有对请求次数加以限制（包括验证用户身份的请求），为了防止暴力攻击和破解，可以考虑使用具有一次消费性的验证码或对这类请求的次数进行限制。</li> <li>将缓存系统、数据库服务器以及重要的资源服务器都放在第二级防火墙之后（不要放在DMZ）。</li></ol> <h2 id="测试相关"><a href="#测试相关" class="header-anchor">#</a> 测试相关</h2> <p>测试是发现和标记缺陷的过程。所谓的缺陷是指实际结果和期望结果之间的任何差别。有的地方，测试也被认为是执行以找出错误为目的的程序的过程。 测试是为了让产品达到以下目标：</p> <ol><li>满足需求用户满意</li> <li>改善产品的市场占有率</li> <li>树立对产品的信任</li> <li>减少开发和维护的成本</li></ol> <h3 id="功能测试"><a href="#功能测试" class="header-anchor">#</a> 功能测试</h3> <p>如果一个软件单元的行为方式与它的开发规范完全一样，那么该软件单元就通过了它的功能测试。</p> <ul><li>白盒测试：开发人员自己实现，最基本的形式是单元测试，还有集成测试和系统测试。</li> <li>黑盒测试：由开发团队之外的人执行，对测试代码没有可见性，将被测系统视为黑盒子。通常由测试人员或QA工程师来执行，Web应用可以通过Selenium这样的测试框架自动化实施。</li></ul> <h3 id="性能测试"><a href="#性能测试" class="header-anchor">#</a> 性能测试</h3> <p>软件在高工作负载下对其响应性和健壮性展开的测试。</p> <ul><li><p>负载测试：在特定负载下执行的测试。</p></li> <li><p>压力测试：突发条件或极限条件下的性能测试。</p></li></ul> <h3 id="安全性测试"><a href="#安全性测试" class="header-anchor">#</a> 安全性测试</h3> <p>系统的敏感数据都是经过认证和授权之后才能访问。</p> <h3 id="其他测试"><a href="#其他测试" class="header-anchor">#</a> 其他测试</h3> <p>易用性测试 / 安装测试 / 可访问性测试</p> <h3 id="单元测试"><a href="#单元测试" class="header-anchor">#</a> 单元测试</h3> <p>测试函数和对象的方法（程序中最小最基本的单元）。通过对实际输出和预期输出的比对以及各种的断言条件来判定被测单元是否满足设计需求。</p> <ul><li>测试用例</li> <li>测试固件 - 每次测试时都要使用的东西。</li> <li>测试套件（测试集）- 组合了多个测试用例而构成的集合。</li></ul> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">UtilTest</span><span class="token punctuation">(</span>unittest<span class="token punctuation">.</span>TestCase<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">setUp</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>pattern <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r'\d{6}'</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">test_gen_mobile_code</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>assertIsNotNone<span class="token punctuation">(</span>self<span class="token punctuation">.</span>pattern<span class="token punctuation">.</span>match<span class="token punctuation">(</span>gen_mobile_code<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">test_to_md5_hex</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        md5_dict <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">'123456'</span><span class="token punctuation">:</span> <span class="token string">'e10adc3949ba59abbe56e057f20f883e'</span><span class="token punctuation">,</span>
            <span class="token string">'123123123'</span><span class="token punctuation">:</span> <span class="token string">'f5bb0c8de146c67b44babbf4e6584cc0'</span><span class="token punctuation">,</span>
            <span class="token string">'1qaz2wsx'</span><span class="token punctuation">:</span> <span class="token string">'1c63129ae9db9c60c3e8aa94d3e00495'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> md5_dict<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>value<span class="token punctuation">,</span> to_md5_hex<span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p><code>TestCase</code>的断言方法：</p> <ul><li>assertEqual / assertNotEqual</li> <li>assertTrue / assertFalse / assertIsNot</li> <li>assertRaise / assertRaiseRegexp</li> <li>assertAlmostEqual / assertNotAlmostEqual</li> <li>assertGreater / assertGreaterEqual / assertLess / assertLessEqual</li> <li>assertRegexpMatches / assertNotRegexpMatches</li> <li>assertListEqual / assertSetEqual / assertTupleEqual / assertDictEqual</li></ul> <p>可以使用nose2或pytest来辅助执行单元测试，同时通过cov-core或pytest-cov可以对测试覆度进行评估。覆盖率由百分比表示。比如测试代码执行过了程序的每一行，那么覆盖率就是100%。这种时候，几乎不会出现新程序上线后突然无法运行的尴尬情况。覆盖率不关心代码内容究竟是什么，覆盖率是用来检查“测试代码不足、测试存在疏漏”的一个指标，“测试内容是否妥当”并不归它管。</p> <div class="language-Shell extra-class"><pre class="language-shell"><code>pip <span class="token function">install</span> nose2 pytest cov-core pytest-cov
</code></pre></div><p>可以使用Selenium来实现Web应用的自动化测试，它还可以用于屏幕抓取与浏览器行为模拟，通过爬虫抓取页面上的动态数据也可以使用它。Selenium其实包括三个部分：</p> <ul><li><p>Selenium IDE：嵌入到浏览器的插件，可以录制和回放脚本。</p> <p><img src="https://cdn.jsdelivr.net/gh/wuKongNotNull/images-hosting/wukong-website/selenium_ide.png" alt=""></p></li> <li><p>Selenium WebDriver：支持多种语言可以操控浏览器的API。</p></li> <li><p>Selenium Standalone Server：Selenium Grid、远程控制、分布式部署。</p></li></ul> <div class="language-Shell extra-class"><pre class="language-shell"><code>pip <span class="token function">install</span> selenium
</code></pre></div><div class="language-Python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">import</span> pytest
<span class="token keyword">import</span> contextlib


<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span><span class="token punctuation">(</span>scope<span class="token operator">=</span><span class="token string">'session'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">chrome</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 设置使用无头浏览器(不会打开浏览器窗口)</span>
    options <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>ChromeOptions<span class="token punctuation">(</span><span class="token punctuation">)</span>
    options<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--headless'</span><span class="token punctuation">)</span>
    driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span>options<span class="token operator">=</span>options<span class="token punctuation">)</span>
    <span class="token keyword">yield</span> driver
    driver<span class="token punctuation">.</span>quit<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">test_baidu_index</span><span class="token punctuation">(</span>chrome<span class="token punctuation">)</span><span class="token punctuation">:</span>
    chrome<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://www.baidu.com'</span><span class="token punctuation">)</span>
    <span class="token keyword">assert</span> chrome<span class="token punctuation">.</span>title <span class="token operator">==</span> <span class="token string">'百度一下，你就知道'</span>
</code></pre></div><p>除了Selenium之外，还有一个Web自动化测试工具名叫Robot Framework。</p> <div class="language-Shell extra-class"><pre class="language-shell"><code>nose2 -v -C
pytest --cov
</code></pre></div><div class="language-Shell extra-class"><pre class="language-shell"><code>Ran <span class="token number">7</span> tests <span class="token keyword">in</span> <span class="token number">0</span>.002s

OK
Name                       Stmts   Miss  Cover
----------------------------------------------
example01.py                  <span class="token number">15</span>      <span class="token number">0</span>   <span class="token number">100</span>%
example02.py                  <span class="token number">49</span>     <span class="token number">49</span>     <span class="token number">0</span>%
example03.py                  <span class="token number">22</span>     <span class="token number">22</span>     <span class="token number">0</span>%
example04.py                  <span class="token number">61</span>     <span class="token number">61</span>     <span class="token number">0</span>%
example05.py                  <span class="token number">29</span>     <span class="token number">29</span>     <span class="token number">0</span>%
example06.py                  <span class="token number">39</span>     <span class="token number">39</span>     <span class="token number">0</span>%
example07.py                  <span class="token number">19</span>     <span class="token number">19</span>     <span class="token number">0</span>%
example08.py                  <span class="token number">27</span>     <span class="token number">27</span>     <span class="token number">0</span>%
example09.py                  <span class="token number">18</span>     <span class="token number">18</span>     <span class="token number">0</span>%
example10.py                  <span class="token number">19</span>     <span class="token number">19</span>     <span class="token number">0</span>%
example11.py                  <span class="token number">22</span>     <span class="token number">22</span>     <span class="token number">0</span>%
example12.py                  <span class="token number">28</span>     <span class="token number">28</span>     <span class="token number">0</span>%
example13.py                  <span class="token number">28</span>     <span class="token number">28</span>     <span class="token number">0</span>%
test_ddt_example.py           <span class="token number">18</span>      <span class="token number">0</span>   <span class="token number">100</span>%
test_pytest_example.py        <span class="token number">11</span>      <span class="token number">6</span>    <span class="token number">45</span>%
test_unittest_example.py      <span class="token number">22</span>      <span class="token number">0</span>   <span class="token number">100</span>%
----------------------------------------------
TOTAL                        <span class="token number">427</span>    <span class="token number">367</span>    <span class="token number">14</span>%
</code></pre></div><p>在测试过程中需要孤立各种外部依赖（数据库、外部接口调用、时间依赖），具体又包括两个方面：</p> <ol><li><p>数据源：数据本地化 / 置于内存中 / 测试之后回滚</p></li> <li><p>资源虚拟化：存根/桩（stub）、仿制/模拟（mock）、伪造（fake）</p> <ul><li>stub：测试期间为提供响应的函数生成的替代品</li> <li>mock：代替实际对象（以及该对象的API）的对象</li> <li>fake：没有达到生产级别的轻量级对象</li></ul></li></ol> <h3 id="集成测试"><a href="#集成测试" class="header-anchor">#</a> 集成测试</h3> <p>集成多个函数或方法的输入输出的测试，测试时需要将多个测试对象组合在一起。</p> <ul><li>测试组件互操作性 / 需求变更测试 / 外部依赖和API / 调试硬件问题 / 在代码路径中发现异常</li></ul> <h3 id="系统测试"><a href="#系统测试" class="header-anchor">#</a> 系统测试</h3> <p>对需求的测试，测试成品是否最终满足了所有需求，在客户验收项目时进行。</p> <h3 id="数据驱动测试"><a href="#数据驱动测试" class="header-anchor">#</a> 数据驱动测试</h3> <p>使用外部数据源实现对输入值与期望值的参数化，避免在测试中使用硬编码的数据。</p> <p>被测函数：</p> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> x <span class="token operator">+</span> y
</code></pre></div><p>data.csv文件：</p> <div class="language- extra-class"><pre class="language-text"><code>3,1,2
0,1,-1
100,50,50
100,1,99
15,7,8
</code></pre></div><p>测试代码：</p> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> csv

<span class="token keyword">from</span> unittest <span class="token keyword">import</span> TestCase
<span class="token keyword">from</span> ddt <span class="token keyword">import</span> ddt<span class="token punctuation">,</span> data<span class="token punctuation">,</span> unpack


<span class="token decorator annotation punctuation">@ddt</span>
<span class="token keyword">class</span> <span class="token class-name">TestAdd</span><span class="token punctuation">(</span>TestCase<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">load_data_from_csv</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">:</span>
        data_items <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> newline<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fs<span class="token punctuation">:</span>
            reader <span class="token operator">=</span> csv<span class="token punctuation">.</span>reader<span class="token punctuation">(</span>fs<span class="token punctuation">)</span>
            <span class="token keyword">for</span> row <span class="token keyword">in</span> reader<span class="token punctuation">:</span>
                data_items<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> row<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> data_items


    <span class="token decorator annotation punctuation">@data</span><span class="token punctuation">(</span><span class="token operator">*</span>load_data_from_csv<span class="token punctuation">(</span><span class="token string">'data.csv'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token decorator annotation punctuation">@unpack</span>
    <span class="token keyword">def</span> <span class="token function">test_add</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> result<span class="token punctuation">,</span> param1<span class="token punctuation">,</span> param2<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>result<span class="token punctuation">,</span> add<span class="token punctuation">(</span>param1<span class="token punctuation">,</span> param2<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="django中的测试"><a href="#django中的测试" class="header-anchor">#</a> Django中的测试</h3> <ol><li>测试Django视图 - Django中提供的<code>TestCase</code>扩展了<code>unittest</code>中的<code>TestCase</code>，绑定了一个名为<code>client</code>的属性，可以用来模拟浏览器发出的GET、POST、DELETE、PUT等请求。</li></ol> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">SomeViewTest</span><span class="token punctuation">(</span>TestCase<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">test_example_view</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        resp <span class="token operator">=</span> self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>get<span class="token punctuation">(</span>reverse<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> resp<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> resp<span class="token punctuation">.</span>context<span class="token punctuation">[</span><span class="token string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><ol start="2"><li>运行测试 - 配置测试数据库。</li></ol> <div class="language-Python extra-class"><pre class="language-python"><code>DATABASES <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'default'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">'ENGINE'</span><span class="token punctuation">:</span> <span class="token string">'django.db.backends.mysql'</span><span class="token punctuation">,</span>
        <span class="token string">'HOST'</span><span class="token punctuation">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>
        <span class="token string">'PORT'</span><span class="token punctuation">:</span> <span class="token number">3306</span><span class="token punctuation">,</span>
        <span class="token string">'NAME'</span><span class="token punctuation">:</span> <span class="token string">'DbName'</span><span class="token punctuation">,</span>
        <span class="token string">'USER'</span><span class="token punctuation">:</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'DB_USER'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'PASSWORD'</span><span class="token punctuation">:</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'DB_PASS'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'TEST'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">'NAME'</span><span class="token punctuation">:</span> <span class="token string">'DbName_for_testing'</span><span class="token punctuation">,</span>
            <span class="token string">'CHARSET'</span><span class="token punctuation">:</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-Shell extra-class"><pre class="language-shell"><code>python manage.py <span class="token builtin class-name">test</span>
python manage.py <span class="token builtin class-name">test</span> common
python manage.py <span class="token builtin class-name">test</span> common.tests.UtilsTest
python manage.py <span class="token builtin class-name">test</span> common.tests.UtilsTest.test_to_md5_hex
</code></pre></div><ol start="3"><li>评估测试覆盖度</li></ol> <div class="language-Shell extra-class"><pre class="language-shell"><code>pip <span class="token function">install</span> coverage
coverage run --source<span class="token operator">=</span><span class="token operator">&lt;</span>path<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> --omit<span class="token operator">=</span><span class="token operator">&lt;</span>path<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span> manage.py <span class="token builtin class-name">test</span> common
coverage report

Name                            Stmts   Miss  Cover
---------------------------------------------------
common/__init__.py                  <span class="token number">0</span>      <span class="token number">0</span>   <span class="token number">100</span>%
common/admin.py                     <span class="token number">1</span>      <span class="token number">0</span>   <span class="token number">100</span>%
common/apps.py                      <span class="token number">3</span>      <span class="token number">3</span>     <span class="token number">0</span>%
common/forms.py                    <span class="token number">16</span>     <span class="token number">16</span>     <span class="token number">0</span>%
common/helper.py                   <span class="token number">32</span>     <span class="token number">32</span>     <span class="token number">0</span>%
common/middlewares.py              <span class="token number">19</span>     <span class="token number">19</span>     <span class="token number">0</span>%
common/migrations/__init__.py       <span class="token number">0</span>      <span class="token number">0</span>   <span class="token number">100</span>%
common/models.py                   <span class="token number">71</span>      <span class="token number">2</span>    <span class="token number">97</span>%
common/serializers.py              <span class="token number">14</span>     <span class="token number">14</span>     <span class="token number">0</span>%
common/tests.py                    <span class="token number">14</span>      <span class="token number">8</span>    <span class="token number">43</span>%
common/urls_api.py                  <span class="token number">3</span>      <span class="token number">3</span>     <span class="token number">0</span>%
common/urls_user.py                 <span class="token number">3</span>      <span class="token number">3</span>     <span class="token number">0</span>%
common/utils.py                    <span class="token number">22</span>      <span class="token number">7</span>    <span class="token number">68</span>%
common/views.py                    <span class="token number">69</span>     <span class="token number">69</span>     <span class="token number">0</span>%
---------------------------------------------------
TOTAL                             <span class="token number">267</span>    <span class="token number">176</span>    <span class="token number">34</span>%
</code></pre></div><h3 id="性能测试-2"><a href="#性能测试-2" class="header-anchor">#</a> 性能测试</h3> <p>问题1：性能测试的指标有哪些？</p> <ol><li><p>ab（ Apache Benchmark） / webbench / httpperf</p> <div class="language-Shell extra-class"><pre class="language-shell"><code>yum -y <span class="token function">install</span> httpd
ab -c <span class="token number">10</span> -n <span class="token number">1000</span> http://www.baidu.com/
<span class="token punctuation">..</span>.
Benchmarking www.baidu.com <span class="token punctuation">(</span>be patient<span class="token punctuation">)</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.done
Server Software:        BWS/1.1
Server Hostname:        www.baidu.com
Server Port:            <span class="token number">80</span>
Document Path:          /
Document Length:        <span class="token number">118005</span> bytes
Concurrency Level:      <span class="token number">10</span>
Time taken <span class="token keyword">for</span> tests:   <span class="token number">0.397</span> seconds
Complete requests:      <span class="token number">100</span>
Failed requests:        <span class="token number">98</span>
   <span class="token punctuation">(</span>Connect: <span class="token number">0</span>, Receive: <span class="token number">0</span>, Length: <span class="token number">98</span>, Exceptions: <span class="token number">0</span><span class="token punctuation">)</span>
Write errors:           <span class="token number">0</span>
Total transferred:      <span class="token number">11918306</span> bytes
HTML transferred:       <span class="token number">11823480</span> bytes
Requests per second:    <span class="token number">252.05</span> <span class="token punctuation">[</span><span class="token comment">#/sec] (mean)</span>
Time per request:       <span class="token number">39.675</span> <span class="token punctuation">[</span>ms<span class="token punctuation">]</span> <span class="token punctuation">(</span>mean<span class="token punctuation">)</span>
Time per request:       <span class="token number">3.967</span> <span class="token punctuation">[</span>ms<span class="token punctuation">]</span> <span class="token punctuation">(</span>mean, across all concurrent requests<span class="token punctuation">)</span>
Transfer rate:          <span class="token number">29335.93</span> <span class="token punctuation">[</span>Kbytes/sec<span class="token punctuation">]</span> received
Connection Times <span class="token punctuation">(</span>ms<span class="token punctuation">)</span>
              min  mean<span class="token punctuation">[</span>+/-sd<span class="token punctuation">]</span> median   max
Connect:        <span class="token number">6</span>    <span class="token number">7</span>   <span class="token number">0.6</span>      <span class="token number">7</span>       <span class="token number">9</span>
Processing:    <span class="token number">20</span>   <span class="token number">27</span>  <span class="token number">22.7</span>     <span class="token number">24</span>     <span class="token number">250</span>
Waiting:        <span class="token number">8</span>   <span class="token number">11</span>  <span class="token number">21.7</span>      <span class="token number">9</span>     <span class="token number">226</span>
Total:         <span class="token number">26</span>   <span class="token number">34</span>  <span class="token number">22.8</span>     <span class="token number">32</span>     <span class="token number">258</span>
Percentage of the requests served within a certain <span class="token function">time</span> <span class="token punctuation">(</span>ms<span class="token punctuation">)</span>
  <span class="token number">50</span>%     <span class="token number">32</span>
  <span class="token number">66</span>%     <span class="token number">34</span>
  <span class="token number">75</span>%     <span class="token number">34</span>
  <span class="token number">80</span>%     <span class="token number">34</span>
  <span class="token number">90</span>%     <span class="token number">36</span>
  <span class="token number">95</span>%     <span class="token number">39</span>
  <span class="token number">98</span>%     <span class="token number">51</span>
  <span class="token number">99</span>%    <span class="token number">258</span>
 <span class="token number">100</span>%    <span class="token number">258</span> <span class="token punctuation">(</span>longest request<span class="token punctuation">)</span>
</code></pre></div></li> <li><p>mysqlslap</p> <div class="language-Shell extra-class"><pre class="language-shell"><code>mysqlslap -a -c <span class="token number">100</span> -h <span class="token number">1.2</span>.3.4 -u root -p
mysqlslap -a -c <span class="token number">100</span> --number-of-queries<span class="token operator">=</span><span class="token number">1000</span> --auto-generate-sql-load-type<span class="token operator">=</span>read -h <span class="token operator">&lt;</span>负载均衡服务器IP地址<span class="token operator">&gt;</span> -u root -p
mysqlslap -a --concurrency<span class="token operator">=</span><span class="token number">50,100</span> --number-of-queries<span class="token operator">=</span><span class="token number">1000</span> --debug-info --auto-generate-sql-load-type<span class="token operator">=</span>mixed -h <span class="token number">1.2</span>.3.4 -u root -p
</code></pre></div></li> <li><p>sysbench</p> <div class="language-Shell extra-class"><pre class="language-shell"><code>sysbench --test<span class="token operator">=</span>threads --num-threads<span class="token operator">=</span><span class="token number">64</span> --thread-yields<span class="token operator">=</span><span class="token number">100</span> --thread-locks<span class="token operator">=</span><span class="token number">2</span> run
sysbench --test<span class="token operator">=</span>memory --num-threads<span class="token operator">=</span><span class="token number">512</span> --memory-block-size<span class="token operator">=</span>256M --memory-total-size<span class="token operator">=</span>32G run
</code></pre></div></li> <li><p>JMeter</p> <p>请查看<a href="https://www.ibm.com/developerworks/cn/java/l-jmeter/index.html" target="_blank" rel="noopener noreferrer">《使用JMeter进行性能测试》<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p></li> <li><p>LoadRunner / QTP</p></li></ol> <h2 id="项目调试"><a href="#项目调试" class="header-anchor">#</a> 项目调试</h2> <p>可以使用django-debug-toolbar来辅助项目调试。</p> <ol><li><p>安装</p> <div class="language-Shell extra-class"><pre class="language-shell"><code>pip <span class="token function">install</span> django-debug-toolbar
</code></pre></div></li> <li><p>配置 - 修改settings.py。</p> <div class="language-Python extra-class"><pre class="language-python"><code>INSTALLED_APPS <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'debug_toolbar'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

MIDDLEWARE <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'debug_toolbar.middleware.DebugToolbarMiddleware'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

DEBUG_TOOLBAR_CONFIG <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment"># 引入jQuery库</span>
    <span class="token string">'JQUERY_URL'</span><span class="token punctuation">:</span> <span class="token string">'https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js'</span><span class="token punctuation">,</span>
    <span class="token comment"># 工具栏是否折叠</span>
    <span class="token string">'SHOW_COLLAPSED'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
    <span class="token comment"># 是否显示工具栏</span>
    <span class="token string">'SHOW_TOOLBAR_CALLBACK'</span><span class="token punctuation">:</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>配置 - 修改urls.py。</p> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token keyword">if</span> settings<span class="token punctuation">.</span>DEBUG<span class="token punctuation">:</span>

    <span class="token keyword">import</span> debug_toolbar

    urlpatterns<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> path<span class="token punctuation">(</span><span class="token string">'__debug__/'</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span>debug_toolbar<span class="token punctuation">.</span>urls<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>使用 - 在页面右侧可以看到一个调试工具栏，上面包括了执行时间、项目设置、请求头、SQL、静态资源、模板、缓存、信号等调试信息，查看起来非常的方便。</p></li> <li><p>项目上线之前，请记住<strong>去掉django-debug-toolbar相关的所有配置</strong>。</p></li></ol> <h2 id="部署相关"><a href="#部署相关" class="header-anchor">#</a> 部署相关</h2> <p>请参考<a href="/Python/02.Django/98.项目部署上线和性能调优.html">《项目部署上线和性能调优》</a>。</p> <h2 id="性能相关"><a href="#性能相关" class="header-anchor">#</a> 性能相关</h2> <h3 id="网站优化两大定律"><a href="#网站优化两大定律" class="header-anchor">#</a> 网站优化两大定律：</h3> <ol><li><p>尽可能的使用缓存 - 牺牲空间换取时间（普适策略）。</p></li> <li><p>能推迟的都推迟 - 使用消息队列将并行任务串行来缓解服务器压力。</p> <ul><li>服务器CPU利用率出现瞬时峰值 - 削峰（CPU利用率平缓的增长）</li> <li>上下游节点解耦合（下订单和受理订单的系统通常是分离的）</li></ul></li></ol> <h3 id="django框架"><a href="#django框架" class="header-anchor">#</a> Django框架</h3> <ol><li><p>配置缓存来缓解数据库的压力，并有合理的机制应对<a href="https://www.cnblogs.com/zhangweizhong/p/6258797.html" target="_blank" rel="noopener noreferrer">缓存穿透和缓存雪崩<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p></li> <li><p>开启<a href="https://docs.djangoproject.com/en/2.0/ref/templates/api/#django.template.loaders.cached.Loader" target="_blank" rel="noopener noreferrer">模板缓存<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>来加速模板的渲染。</p> <div class="language-Python extra-class"><pre class="language-python"><code>TEMPLATES <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">'BACKEND'</span><span class="token punctuation">:</span> <span class="token string">'django.template.backends.django.DjangoTemplates'</span><span class="token punctuation">,</span>
        <span class="token string">'DIRS'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>BASE_DIR<span class="token punctuation">,</span> <span class="token string">'templates'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token comment"># 'APP_DIRS': True,</span>
        <span class="token string">'OPTIONS'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">'context_processors'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token string">'django.template.context_processors.debug'</span><span class="token punctuation">,</span>
                <span class="token string">'django.template.context_processors.request'</span><span class="token punctuation">,</span>
                <span class="token string">'django.contrib.auth.context_processors.auth'</span><span class="token punctuation">,</span>
                <span class="token string">'django.contrib.messages.context_processors.messages'</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'loaders'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>
                <span class="token string">'django.template.loaders.cached.Loader'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
                    <span class="token string">'django.template.loaders.filesystem.Loader'</span><span class="token punctuation">,</span>
                    <span class="token string">'django.template.loaders.app_directories.Loader'</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div></li> <li><p>用惰性求值、迭代器、<code>defer()</code>、<code>only()</code>等缓解内存压力。</p></li> <li><p>用<code>select_related()</code>和<code>prefetch_related()</code>执行预加载避免“1+N查询问题”。</p></li></ol> <h3 id="数据库"><a href="#数据库" class="header-anchor">#</a> 数据库</h3> <ol><li><p>用ID生成器代替自增主键（性能更好、适用于分布式环境）。</p> <ul><li><p>自定义ID生成器 - snowflake</p></li> <li><p>UUID</p></li></ul> <div class="language-Python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> my_uuid <span class="token operator">=</span> uuid<span class="token punctuation">.</span>uuid1<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> my_uuid
UUID<span class="token punctuation">(</span><span class="token string">'63f859d0-a03a-11e8-b0ad-60f81da8d840'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> my_uuid<span class="token punctuation">.</span><span class="token builtin">hex</span>
<span class="token string">'63f859d0a03a11e8b0ad60f81da8d840'</span>
</code></pre></div></li> <li><p>避免不必要的外键列上的约束（除非必须保证参照完整性），更不要使用触发器之类的机制。</p></li> <li><p>使用索引来优化查询性能（索引放在要用于查询的字段上）。InnoDB用的是BTREE索引，使用&gt;、&lt;、&gt;=、&lt;=、BETWEEN或者LIKE 'pattern'（pattern不以通配符开头）时都可以用到索引。因为建立索引需要额外的磁盘空间，而主键上是有默认的索引，所以主键要尽可能选择较短的数据类型来减少磁盘占用，提高索引的缓存效果。</p> <div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">index</span> idx_goods_name <span class="token keyword">on</span> tb_goods <span class="token punctuation">(</span>gname<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token comment">-- 无法使用索引</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_goods <span class="token keyword">where</span> gname <span class="token operator">like</span> <span class="token string">'%iPhone%'</span><span class="token punctuation">;</span>
<span class="token comment">-- 可以使用索引</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_goods <span class="token keyword">where</span> gname <span class="token operator">like</span> <span class="token string">'iPhone%'</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-Python extra-class"><pre class="language-python"><code><span class="token comment"># 无法使用索引</span>
Goods<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>name_icontains<span class="token operator">=</span><span class="token string">'iPhone'</span><span class="token punctuation">)</span>
<span class="token comment"># 可以使用索引</span>
Goods<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>name__istartswith<span class="token operator">=</span><span class="token string">'iPhone'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>使用存储过程（存储在服务器端编译过的一组SQL语句）。</p> <div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">drop</span> <span class="token keyword">procedure</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> sp_avg_sal_by_dept<span class="token punctuation">;</span>

<span class="token keyword">create</span> <span class="token keyword">procedure</span> sp_avg_sal_by_dept<span class="token punctuation">(</span>deptno <span class="token keyword">integer</span><span class="token punctuation">,</span> <span class="token keyword">out</span> avg_sal <span class="token keyword">float</span><span class="token punctuation">)</span>
<span class="token keyword">begin</span> 
    <span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token keyword">into</span> avg_sal <span class="token keyword">from</span> TbEmp <span class="token keyword">where</span> dno<span class="token operator">=</span>deptno<span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>

<span class="token keyword">call</span> sp_avg_sal_by_dept<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token variable">@a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">select</span> <span class="token variable">@a</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-Python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> connection
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> cursor <span class="token operator">=</span> connection<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> cursor<span class="token punctuation">.</span>callproc<span class="token punctuation">(</span><span class="token string">'sp_avg_sal_by_dept'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'select @_sp_avg_sal_by_dept_1'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> cursor<span class="token punctuation">.</span>fetchone<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">2675.0</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>使用数据分区。通过分区可以存储更多的数据、优化查询更大的吞吐量、可以快速删除过期的数据。关于这个知识点可以看看MySQL的<a href="https://dev.mysql.com/doc/refman/5.7/en/partitioning-overview.html" target="_blank" rel="noopener noreferrer">官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <ul><li>RANGE分区：基于连续区间范围，把数据分配到不同的分区。</li> <li>LIST分区：基于枚举值的范围，把数据分配到不同的分区。</li> <li>HASH分区 / KEY分区：基于分区个数，把数据分配到不同的分区。</li></ul> <div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> tb_emp <span class="token punctuation">(</span>
    eno <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    ename <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    job <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    hiredate <span class="token keyword">DATE</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    dno <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>
<span class="token punctuation">)</span>
<span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> <span class="token keyword">HASH</span><span class="token punctuation">(</span>dno<span class="token punctuation">)</span>
PARTITIONS <span class="token number">4</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> tb_emp <span class="token punctuation">(</span>
    eno <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    ename <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    job <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    hiredate <span class="token keyword">DATE</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    dno <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>
<span class="token punctuation">)</span>
<span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> RANGE<span class="token punctuation">(</span> <span class="token keyword">YEAR</span><span class="token punctuation">(</span>hiredate<span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">(</span>
    <span class="token keyword">PARTITION</span> p0 <span class="token keyword">VALUES</span> LESS THAN <span class="token punctuation">(</span><span class="token number">1960</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">PARTITION</span> p1 <span class="token keyword">VALUES</span> LESS THAN <span class="token punctuation">(</span><span class="token number">1970</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">PARTITION</span> p2 <span class="token keyword">VALUES</span> LESS THAN <span class="token punctuation">(</span><span class="token number">1980</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">PARTITION</span> p3 <span class="token keyword">VALUES</span> LESS THAN <span class="token punctuation">(</span><span class="token number">1990</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">PARTITION</span> p4 <span class="token keyword">VALUES</span> LESS THAN MAXVALUE
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>使用<code>explain</code>来分析查询性能 - 执行计划。</p> <div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
</code></pre></div><p><code>explain</code>结果解析：</p> <ul><li>select_type：表示select操作的类型，常见的值有SIMPLE（简单查询，没有使用子查询或者表连接查询）、PRIMARY（主查询，外层的查询）、UNION（并集操作中的第二个或者后面的查询）、SUBQUERY（子查询中的第一个SELECT）等。</li> <li>table：输出结果的表。</li> <li>type：MySQL在表中找到所需行的方式，也称为访问类型，常见的值有：
<ul><li>ALL：全表扫描（遍历全表找到匹配的行）</li> <li>index：索引全扫描（遍历整个索引）</li> <li>range：索引范围扫描</li> <li>ref：非唯一索引扫描或唯一索引的前缀扫描</li> <li>eq_ref：唯一索引扫描</li> <li>const / system：表中最多有一行匹配</li> <li>NULL：不用访问表或者索引</li></ul></li> <li>possible_keys：查询时可能用到的索引。</li> <li>key：实际使用的索引。</li> <li>key_len：使用到索引字段的长度。</li> <li>rows：扫描行的数量。</li> <li>Extra：额外的信息（执行情况的说明或描述）。</li></ul> <blockquote><p>说明：关于MySQL更多的知识尤其是性能调优和运维方面的内容，推荐大家阅读网易出品的《深入浅出MySQL（第2版）》，网易出品必属精品。</p></blockquote></li> <li><p>使用慢查询日志来发现性能低下的查询。</p> <div class="language-SQL extra-class"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'slow_query%'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------------------+----------------------------------+</span>
<span class="token operator">|</span> Variable_name             <span class="token operator">|</span> <span class="token keyword">Value</span>                            <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------------+----------------------------------+</span>
<span class="token operator">|</span> slow_query_log            <span class="token operator">|</span> <span class="token keyword">OFF</span>                              <span class="token operator">|</span>
<span class="token operator">|</span> slow_query_log_file       <span class="token operator">|</span> <span class="token operator">/</span>mysql<span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span>localhost<span class="token operator">-</span>slow<span class="token punctuation">.</span>log   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------------+----------------------------------+</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'long_query_time'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------------+-----------+</span>
<span class="token operator">|</span> Variable_name   <span class="token operator">|</span> <span class="token keyword">Value</span>     <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------+-----------+</span>
<span class="token operator">|</span> long_query_time <span class="token operator">|</span> <span class="token number">10.000000</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------+-----------+</span>
</code></pre></div><div class="language-SQL extra-class"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">set</span> <span class="token keyword">global</span> slow_query_log<span class="token operator">=</span><span class="token string">'ON'</span><span class="token punctuation">;</span> 
mysql<span class="token operator">&gt;</span> <span class="token keyword">set</span> <span class="token keyword">global</span> long_query_time<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-INI extra-class"><pre class="language-ini"><code><span class="token header"><span class="token punctuation">[</span><span class="token section-name selector">mysqld</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">slow_query_log</span><span class="token punctuation">=</span><span class="token value attr-value">ON</span>
<span class="token key attr-name">slow_query_log_file</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/local/mysql/data/slow.log</span>
<span class="token key attr-name">long_query_time</span><span class="token punctuation">=</span><span class="token value attr-value">1</span>
</code></pre></div></li></ol></div></div> <div class="page-slot page-slot-bottom"><!-- 横向自适应 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6620245489"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2021/11/03, 11:04:58</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/f68704/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">用FastAPI开发数据接口</div></a> <a href="/pages/5d0abd/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">电商网站技术要点剖析</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/f68704/" class="prev">用FastAPI开发数据接口</a></span> <span class="next"><a href="/pages/5d0abd/">电商网站技术要点剖析</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/610238/"><div>浏览器模型(四)</div></a> <span>12-12</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/229568/"><div>浏览器模型(一)</div></a> <span>12-11</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/ffb0a1/"><div>浏览器模型(二)</div></a> <span>12-11</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:1390128154@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/wuKongNotNull" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2020-2022
    <span>悟空非空也 | <a href="https://github.com/WuKongNotNull/wukong-post/blob/main/LICENSE" target="_blank">Apache License 2.0</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><i class="close-but">×</i> <div><!-- 固定160*160px -->
      <ins class="adsbygoogle"
          style="display:inline-block;max-width:160px;max-height:160px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="8377369658"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
      </div></div></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.0772105c.js" defer></script><script src="/assets/js/2.6497fd29.js" defer></script><script src="/assets/js/170.f3785783.js" defer></script>
  </body>
</html>